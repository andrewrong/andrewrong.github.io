<!doctype html>



  


<html class="theme-next muse use-motion" lang="english">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="nomoshen" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="nomoshen">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="nomoshen">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="nomoshen">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> nomoshen </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="english">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">nomoshen</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">尽可能努力一点点</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/何为国债/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/03/03/何为国债/" itemprop="url">
                  何为债券
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-03T18:51:53+08:00">
                2020-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/财经/" itemprop="url" rel="index">
                    <span itemprop="name">财经</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-债券"><a href="#1-债券" class="headerlink" title="1. 债券"></a>1. 债券</h3><ul>
<li>wiki-定义</li>
</ul>
<blockquote>
<p>债券(Notes)是政府、金融机构、工商企业等机构直接向社会借债筹措资金时，向投资者发行，承诺按一定利率支付利息并按约定条件偿还本金的债权债务凭证。债券的本质是债的证明书，具有法律效力。债券购买者与发行者之间是一种债权债务关系，债券发行人即债务人(Debtors)，投资者（或债券持有人）即债权人(Creditors)。最常见的债券为定息债券、浮息债券以及零息债券。</p>
</blockquote>
<ul>
<li>与银行贷款的不同</li>
</ul>
<blockquote>
<p>与银行信贷不同的是，债券是一种直接债务关系。银行信贷通过存款人——银行，银行——贷款人形成间接的债务关系。</p>
</blockquote>
<h4 id="债券的特性"><a href="#债券的特性" class="headerlink" title="债券的特性"></a>债券的特性</h4><ol>
<li>债券属于有价证券</li>
<li>债券是一种虚拟资本</li>
<li>债券是债权的表现</li>
</ol>
<h4 id="债券的基本要素"><a href="#债券的基本要素" class="headerlink" title="债券的基本要素"></a>债券的基本要素</h4><ul>
<li>债券价格：也就是债券的面值; 面值是固定的，但是购买这些债券的花费的价值是不固定的，有时候高有时候低;</li>
<li>债券利息: 债券利率是<strong>债券利息</strong>与<strong>债券面值</strong>的比率。债券利率分为固定利率和浮动利率两种。债券利率一般为年利率，面值与利率相乘可得出年利息。债券利率直接关系到债券的收益。影响债券利率的因素主要有银行利率水平、发行者的资信状况、债券的偿还期限和资金市场的供求情况等</li>
<li><p>债券还本期限与方式</p>
<ul>
<li>债券还本期限是指从债券发行到归还本金之间的时间</li>
<li>债券还本方式是指一次还本还是分期还本等，还本方式也应在债券票面上注明。</li>
</ul>
</li>
</ul>
<h4 id="债券的特征"><a href="#债券的特征" class="headerlink" title="债券的特征"></a>债券的特征</h4><ul>
<li>期限性</li>
<li>流动性: 仅仅次于储蓄存款；流动性非常好</li>
<li>收益性: 票息（债券利息） + 债券买卖价格差 = 债券收益率</li>
<li><p>安全性</p>
<p>  <strong>市场风险是指债券的市场价格随资本市场的利率上涨而下跌，因为债券的价格是与市场利率呈反方向变动的。当利率下跌时，债券的市场价格便上涨；而当利率上升时，债券的市场价格就下跌。而债券距离到期日越远，其价格受利率变动的影响越大。</strong></p>
</li>
<li><p>自主性</p>
</li>
</ul>
<h4 id="债券类型"><a href="#债券类型" class="headerlink" title="债券类型"></a>债券类型</h4><ul>
<li><p>按照发行主体分类</p>
<ul>
<li>政府</li>
<li>金融债券</li>
<li>企业债券</li>
</ul>
</li>
<li><p>按付息方式划分</p>
<ul>
<li><strong>贴现债券</strong>: 购买债券的时候，按照折扣来进行买；这样折扣就是利息;</li>
<li><strong>零息债券</strong>: 零息债券指债券到期时和本金一起一次性付息、利随本清，也可称为到期付息债券。付息特点一是利息一次性支付。二是债券到期时支付。</li>
<li><strong>附息债券</strong>: 附息债券指债券券面上附有息票的债券，是按照债券票面载明的利率及支付方式支付利息的债券。息票上标有利息额、支付利息的期限和债券号码等内容。持有人可从债券上剪下息票，并据此领取利息。附息国债的利息支付方式一般是在偿还期内按期付息，如每半年或一年付息一次。</li>
<li><strong>固定利率债券</strong>: 是在偿还期内利率固定的债券</li>
<li><strong>浮动利率债券</strong>: 浮动利率债券是指利率可以变动的债券。这种债券的利率确定与市场利率挂钩，一般高于市场利率的一定百分点。</li>
</ul>
</li>
<li><p>按照偿还期限划分</p>
<ul>
<li>长期：&gt; 10年; 我国是5年为分割点</li>
<li>中期:1 ~ 10年</li>
<li>短期: &lt; 1年</li>
</ul>
</li>
<li><p>按照是否可转换来区分</p>
<ul>
<li>可转债债券</li>
<li><p>不可转换债券</p>
<p>可转换债券是能按一定条件转换为其他金融工具的债券，而不可转换债券就是不能转化为其他金融工具的债券。可转换债券一般都是指的可转换公司债券，这种债券的持有者可按一定的条件根据自己的意愿将持有的债券转换成股票。</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-债券市场"><a href="#2-债券市场" class="headerlink" title="2. 债券市场"></a>2. 债券市场</h3><p>债券市场, 分为一级市场和二级市场; 其实一开始我很不能理解，为什么会存在债券这种东西? 它存在的形式有的时候和股票那么像，可能买来买去，而且竟然价格还会那么不一致；这主要原因在于: </p>
<blockquote>
<p>债券市场，一个将债券变成可以交易的东西，而不再是只有两个人的关系; 现在的金融市场的基础是信用; 而债券本身就是信用证明，证明了其实期限一到就可以获得一笔钱; 这样以来，其实被借人可以将债券证明卖掉，来提前获得钱;</p>
<p>就这样,债券市场就产生了；那为什么会有价格高低呢? 原因在于每个时间点的利率是不一样的，与国家的基本利率有关系; 比如去年借钱利率是5%，但是今年就只有1%，那么如果5%的债券出来卖的时候价格肯定是高的，因为买走这个债券是有稳定的可预见的收益;</p>
</blockquote>
<h3 id="3-例子"><a href="#3-例子" class="headerlink" title="3. 例子"></a>3. 例子</h3><ol>
<li>2010年，利率为5%, A为B借了100元; 那么就产生了借条: 100元，年利率为5%</li>
<li>2013年, B已经拿了两年的利息, 也就是10元；但是由于他比较缺钱，他需要把这个借条卖掉; 这年的利率是1%；</li>
<li>因为2013年的利率很低，所以B卖出这个债券的价格就比债券本身的面值(100)要高; 比如卖出的价格是105元; </li>
<li>那么B总共赚的钱是 10 + 5 = 15; 那么他的年华收益率100 <em> (1 + x) </em> (1 + x) = 115; 年化利率大概是7%； 这个利率比银行高好多啊; </li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/20/2019年-年终总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/01/20/2019年-年终总结/" itemprop="url">
                  2019年-年终总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-20T16:54:29+08:00">
                2020-01-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/总结/" itemprop="url" rel="index">
                    <span itemprop="name">总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2019年过完了; 今天离农历过年还有几天，属于很明显的垃圾时间,大家都比较轻松，并且事情也都能拖到年后来做，所以就找了今天下午出来酱油写一下去年的年终总结；其实每年的年终总结都挺水的，所以今年就稍微不同一下，总结一下去年的好的，今年想要做的；简单一些，不罗列太多无用的东西;</p>
<h3 id="1-去年总结"><a href="#1-去年总结" class="headerlink" title="1. 去年总结"></a>1. 去年总结</h3><p>去年做了几个选择，想了很久但是一直没有行动，去年一年就做了不少的改变，我觉得还挺好的，佩服自己的抉择;有的改变是主动的、有的是被动的，但是从目前来看都挺好的，就类似于伯爵说的，老天永远在往好的方向在推动我; 在这边谢谢老天爷;</p>
<h4 id="1-1-换了工作"><a href="#1-1-换了工作" class="headerlink" title="1.1 换了工作"></a>1.1 换了工作</h4><p>从1年多前就开始尝试出去面试，目标是阿里；总的来说，其实面的并不是很好；除了自己水平原因之外，很重要的一点在于我想做的一直是存储，导致面试阿里存储的时候我的水平一直没到位；后期，自己一直也在思考是否合适，并且也有补习相关的知识，慢慢的就转变了方向；开始面试自己比较擅长的监控领域，这个决策还是很ok的，一下子面试就进步很快; 可能是运气真的很好，来的这个部门刚刚有人走; 当时阿里的招聘的策略是走一个才能进一个，而且必须是7的层级; </p>
<p>面试过程比较顺利，并且进度也很快; 当然真的拿到offer的过程是挺漫长的；中间还去了一家神奇的公司，让我对小公司一下子就没有了好感；索性的是它在去年11月份就倒闭了，说真的心里挺开心的；因为这家公司真的很糟糕;</p>
<p>终于成功的来到了阿里，还是比较兴奋的; 因为一直想来这种世界级公司，看看什么不一样；而且毕业的时候也没成功进来; 来了阿里，其实整体的文化氛围还是很ok的，和之前的公司的感觉很像；大概率因为我们之前那个公司大部分是从阿里过去的，所以文化也超级像；所以适应这种环境还是很快的；</p>
<p>当然最艰难的主要是和同事相处；相处的还挺漫长，我也不知道如何和他们相处；不过虽然他们不怎么说话，但是整体很nice，我有什么问题他们都会积极的; 另外的问题就是适应他们的产品，而且需要寻找自己的定位；我不知道如何去介入到他们做的事情，做多了怕让他们觉得我抢工作，做少了又怕3.25；有点尴尬;</p>
<p>不管怎么说，工作换了，也算是走出了自己的舒服区；去尝试各种不一样的团队和不一样公司，让自己有着更加好的成长;</p>
<h4 id="1-2-开始持久的健身"><a href="#1-2-开始持久的健身" class="headerlink" title="1.2 开始持久的健身"></a>1.2 开始持久的健身</h4><p>去年过年回来之后，我花了将近2w元去办了一个健身卡和报了私交; 开始了自己的健身之路；成果挺好的；大概花了3个月就从160到了140，不过减肥之路还是很辛苦和花钱；不过我觉得值得，因为这是为自己投资；后面又胖回来了一点，但是整体通过持续的锻炼还ok；</p>
<p>今年依然还是买了1w块课程，准备比较系统的学习一下无氧的肌肉运动；但是目前感觉是自己貌似没有学到太多，只是每次让教练监督我练习；明年的话我也多请教一下教练好好的掌握技巧，能在后面自己就能完成练习;</p>
<p>自己健身主要是为了身材、健康和给自己一个目标；所以今年算是坚持下来了，后面要持续支持，让自己的身体更加健康;</p>
<h4 id="1-3-开始学习财务知识"><a href="#1-3-开始学习财务知识" class="headerlink" title="1.3 开始学习财务知识"></a>1.3 开始学习财务知识</h4><p>一直想，一直想学，但是总是没有行动；因为入门的那一脚有点难，一直借口着不去尝试；不过去年真的在离职的前几个月，也不知道为什么就开始认识了公司的一个朋友；其实他和我在公司的时间差不多，之前是认识的，但是不那么熟悉；但是因为kafka迁移让我们关系越来越熟悉，到后面饭后一起走路，到后面他给我们讲于我们不同的观点；慢慢的我就发现着就是我想要学习的东西；而现在这个时间点，这个人出现了，并且他真的很愿意和我们分享这些知识，于是我就下决心好好的把这块补上;</p>
<p>他家相对比较富裕，但是他有着更加遥远的梦想；他的观点是想要让自己做到财富自由；这边的财富自由值得是支付和被动收入相同，也就是即使不上班你也不会饿死；目前我的状态是工作是我唯一的收入，而我的支付有很多很多，房贷就是最大的支出；假设我不工作我感觉用不了多久我就活不下去了. 所以我的人生是被动的。而在遇到他之前，我的想法很简单的，就是如何去提高自己的工资，如何让工作给我赚更多的钱；这条一路走到黑。</p>
<p>关于这点，我突然想到了一个观点；每个人的格局或者视野什么的本来就是需要是被开阔的，不会有一个人天生就格局很大；普通人通常会是这样的一个过程，给了一条路，就觉得这条路就是适合自己，然后不断的往里面走，直到走到黑为止；但是其实可能这条本来就是错的，也不是唯一的，只不过是一开始冒失的一个选择而已；中国人真的很悲剧，在不了解的情况下，做出了人生后半辈子的选择，导致很多人在干的过程中很辛苦很累.而后半辈子因为生活压力的情况下，也不敢再去做尝试，只能默默的承受的这条路;</p>
<p>所以如果你觉得这条路走的很难受，或者你觉得前途很不行；那么是否可以考虑一下，是不是这条本来就不是自己选择的，而且也不知道有什么错误； 换条路是否可能；尤其是年轻人一定要多尝试；尝试可以让你不断去试错，直到找到自己觉得舒服的道路；事半功倍可能;</p>
<p>而对于已经承受着人生压力我来说，轻易的换肯定会导致生活的严重抖动；在计算机中就是要如何平滑重启；既然你已经在这条路上走了，那就先走着，但是你需要去接触除了这条路以外的事物，比如经济学，比如社会学，比如其他的任何东西；虽然你没有试错的机会，但是你可以通过主动学习去开阔自己的视野，这是一种准备，为未来的准备；现在可能会辛苦，但是当你在未来某一个时刻，你在做出选择的时候可能是多条路的选择，而不是一路走黑的选择； </p>
<p>昨天和一个小朋友聊；他说他可能还是有点喜欢计算机的，我说这个没问题，但是这不是你不去做尝试的借口；作为工作计算机可以帮你赚钱养家，但是它并非是你唯一的一条路，你的人生可以有多个路，这个路并非说现在就你让你来换，而是一种准备，在未来的某一个时刻，你发现计算机这条路已经不适合的你的时候，你有其他的路可以走；而且也会让你能更加早的去判断是否这条路合理; 如果合理那就更加应该努力学习而不是茫然;</p>
<p>说了那么多精神方面的，其实想说的总结：</p>
<ul>
<li>保持主动学习，这个学习不一定是看书，也可以尝试其他的东西;</li>
<li>学习可能现在没用，但是后面会有用;</li>
<li>等你的格局或者知识慢慢有变化之后，你就越是能判断当前这路的未来; 如果值得那就不会再迷失自己;</li>
<li>多接触非这条路上的人;</li>
</ul>
<p>关于自己，去年的观点有了比较多的转变; 我看了富爸爸系列的几本书，还看了基金相关的，虽然现在还挺糊涂的，但是慢慢的我觉得会好起来; 去年的投资也还ok，只不过大部分还是无脑操作；后面慢慢的需要去了解这一切的东西;</p>
<h4 id="1-4-存款"><a href="#1-4-存款" class="headerlink" title="1.4 存款"></a>1.4 存款</h4><p>去年基本完成了存款目标；也幸好是我那个朋友说，先让我存6个月的支出，然后放起来，其他的再来投资; 慢慢也有点积蓄能抗风险，希望未来能越来越好;</p>
<h3 id="2-2020年的规划"><a href="#2-2020年的规划" class="headerlink" title="2. 2020年的规划"></a>2. 2020年的规划</h3><p>今年的规划我只是想写个大方向，不想太过细节; 2019年虽然上面几个小目标都完成了，但是依然是一个打酱油的一年，2月份～9月在上一家公司安心的打着酱油, 9月～1月在新公司打酱油；</p>
<p>为什么能在新公司打酱油呢；主要还是因为这个领域能做的东西其实并不是很多，而且团队比较大，所以能分到自己手上的东西就很少。每天改console是我最主要的东西；说真的这个工作真没意思，没有任何挑战；本来到了年底想和老板好好聊聊，看看能不能从他未来的规划中找出一块有价值的事情；但是最后整个团队散了，老板和师兄都转岗了，我们部分团队和另外的团队合并了，另外一些全心做产品；我感觉这是一次机会，因为后面的远景很大的，世界级别的，而且是我喜欢做的技术相关的，有技术挑战性。来了这边我才觉得技术成长对我来说是什么？是一种快乐，是一种每天都愿意奋斗的动力. 所以2020-2021我的目前就是搞定这个世界级别的技术问题，然后能获得自己想要的成果;</p>
<h4 id="2-1-工作"><a href="#2-1-工作" class="headerlink" title="2.1 工作"></a>2.1 工作</h4><p>虽然不清楚后面要做什么，但是目前新老板画的饼我非常喜欢，真的是吃准了技术人员的大饼. 钱很重要，但是技术人员喜欢的挑战，目前我后面主要做我领域的基础技术平台开发, 后面要接入每秒上千万的tps. 我之前公司最最最顶峰的时候才100w，所以这太吸引我了. </p>
<p>我自己的打算是这样的：</p>
<ul>
<li>先承接住目前sunfire的稳定性; 目前主要是对整体的解决问题的能力、对一些细节的掌握，可能是我比较弱的点; 不过目前机会还是蛮好的，我的层级和目前机会的空缺，估计应该可以顺利的接过来; 主要我能主动点;</li>
<li>云监控那边我目前还不怎么清楚;但是我后面想主要放精力的两个方面是：1. 监控数据实时计算 2. 比较友好的预聚合方案 3. 存储引擎；关于展示和采集、报警我其实兴趣不大; 后面就往这块走;</li>
<li>研究一下开源的时序数据库和nosql的存储引擎，怎么样来调和两者;</li>
</ul>
<p>这次调整机会还是很大的，所以能不能抓住要看自己了；我觉得这已经是在我擅长的赛道上进行比赛了，所以老天已经对我很好了，要自己争气啊; 加油加油..</p>
<h4 id="2-2-财务理财"><a href="#2-2-财务理财" class="headerlink" title="2.2 财务理财"></a>2.2 财务理财</h4><p>2020年的目标是真正入门到这个行业,个人觉得可能需要从理论、观点和实战方面全方面进行; 虽然2019年已经开始进行了投资的行为，但是大部分还是通过感觉来进行的；所以2020年就像逐步构建自己的经济学的知识体系，通过实践来不断的完善自己的知识体系; 就目前想得到的目标有几个：</p>
<ul>
<li>能轻松分析国外和国内的公司财报</li>
<li>自己来操作基金组合定投</li>
<li>从跟着别人做资产配置变成自己做资产配置</li>
<li>做公司估值分析</li>
</ul>
<p>这几个方面可能需要看很多书，需要自律; 但是这是没有办法的，学习本来就是逆人性的过程，不能只是焦虑，需要的是去了解这些知识，为后面的未知做好准备; </p>
<p>目前这两条路是我预防我中年危机的手段; 上次在玩现金流游戏的时候让我知道了几个重要点:</p>
<ol>
<li>工资收入高，可以带来很多现金流; 工作上面的努力可以让你很快的积累现金流;</li>
<li>工资高如果支付高，那么想达到财富自由是不可能的; 所以尽可能避免无效开支，不能说因为收入很高，就花费很多; </li>
<li>被动收入真的很重要; 企业和房产的被动收入相差比较大; 需要在生活过程中不断的去寻找高回报的现金流资产. 这个过程可能很艰难，但是这可能是未来一条正确的道路，不然等真的到了35岁的时候，就真的一点办法都没了，我实在太害怕回到农村，我想给孩子一个好的环境，一个能让她尝试各种东西的环境；这样的环境能让她能让我能让我老婆做出心所向往的选择，而不是被迫无奈的选择.</li>
</ol>
<p>加油，2020年的自己…一定要自律自律自律，的确反人性，但是这才是真的吃苦;</p>
<h4 id="2-3-健身"><a href="#2-3-健身" class="headerlink" title="2.3 健身"></a>2.3 健身</h4><p>钱已经花了，后面就按照教练的课程好好练就好了; 但是2020年有几个想要完成的目标：</p>
<ul>
<li>体重达到120～130斤差不多;</li>
<li>学习一整套比较完整的动作，之后就按照这个套路训练就可以;</li>
</ul>
<h3 id="3-写给下一次看的自己"><a href="#3-写给下一次看的自己" class="headerlink" title="3. 写给下一次看的自己"></a>3. 写给下一次看的自己</h3><p>目标每年都定，不知道每年是否有回顾过自己的目标完成的程度; 希望每个一段时间都来回顾自己的计划，然后总结一下自己是否偏离目标，如果偏离合理，那么目标是否要调整; 2019年是一个不错的开始也有一个不错的结尾，后面就靠自己努力进步; 加油加油…</p>
<p>感情这个东西，对我来说真的很难驾驭，本身的性格缺陷，让我有的时候程度很难把握..哎.. 2020年我希望自己能大方一些，不要太在意很多小东西；并且主动去交流，我想这样一定会有点改善;</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/04/关于Linux内存的一些知识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/04/04/关于Linux内存的一些知识/" itemprop="url">
                  关于Linux内存的一些知识
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-04T11:50:57+08:00">
                2019-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li><p>页表</p>
<p> 每个进程都会有自己的页表，页表的主要的作用就是将虚拟地址转化为真实的物理地址；通过页表的架构是这样的：</p>
<p> <img src="media/9C2C6E33-E0C4-4EEC-9F24-37C2C6E6917E.png" alt="9C2C6E33-E0C4-4EEC-9F24-37C2C6E6917E"></p>
</li>
</ol>
<p>有三个部分组成</p>
<pre><code>* 页表目录
* 页表
* 偏移量
</code></pre><p>多级的好处是节省内存占用率，如果只有一级的话，那么即使不用全部的线程地址，也会占用很多无效内存; 所以多级可以有效的介绍这部分的开销;</p>
<p>那不同进程是如何找到自己的页表的物理地址呢？那么就要靠<code>cr3(控制寄存器)</code>，每次进程切换会把这个寄存器恢复，那么每次查找页表的时候就可以轻而易举的找到页表；</p>
<ol>
<li><p>页表和页的权限控制</p>
<p> 根据User/Supervisor这个flag来设置权限;这个flag是存在页表项的;</p>
<ul>
<li>0: 必须是内核态才能访问</li>
<li><p>1: 总能访问</p>
<p>通过这个就可以保护内存的访问，有的只有内核态的进程才能访问;</p>
</li>
</ul>
</li>
<li><p>PAE（物理地址扩展）</p>
<p> 明明地址空间只有32bit，如何能使用超过4GB的物理内存空间呢；就出现了PAE了; 其本质在于在cr3这个寄存器上做了手段；cr3本身指向页表的物理地址，所以cr3可以变化，可以指向多个页表的物理地址就可以访问多个物理地址了；<br> 寻址空间依然是4GB，只不过通过切换来使用更多的内存；但是由于用户态的进程不能修改页表，所以它无法使用超过4GB的物理内存；</p>
</li>
<li><p>高速缓存和TLB</p>
<p> 高速缓存主要解决的是cpu与ram速度的巨大差异，用来缓解这个过程；在cpu和ram之间加入高速缓存，cpu直接访问cache而不是RAM；使用的原理当时就是局部性原理；</p>
<pre><code>* 时间局部性: 在一定返回内会重复执行某一些东西
* 空间局部性: 访问了一个地址空间的内容，有极大的概率会访问周边的内存
</code></pre><p> 高速缓存的组成是cacheline，每一个cacheline大概是64kb; 那么如果确定当前地址是否在cache中呢，其实方式依然还是用虚拟地址中的各个地址位来进行判断;目前有三种；</p>
<p> TLB: 我们知道虚拟地址转为物理地址需要通过查找页表来进行；那么我们也知道RAM的速率和cpu相比很慢，如果每次都走一次RAM那基本上就没得玩了；所以TLB就是一个保存virtual-&gt;phyical的一个kv硬件缓存；但是当cr3这个寄存器修改的时候，TLB就会失效；so 切换进程是多么耗时的事情;</p>
</li>
<li><p>物理内存分布</p>
<p> 内核会将下面的页框保留下来，不会被动态分配和交换到磁盘上去 </p>
<ul>
<li>在不可用的物理地址范围内的页框</li>
<li><p>含有内核代码和已初始化的数据结构的页框</p>
<p>内核通常为了能保存在物理内存上连续存储，会选择跳过第一个MB，从0x00100000的物理地址开始使用;</p>
</li>
</ul>
</li>
<li><p>内核页表</p>
<p> 进程的页表在内核部分的页表是公用的；通过的方式是每次生成一个新的进程的时候，新的页表中内核页表是指向原来的进程是一样的；而用户态的页表是使用cow的方式，虽然也是一样的，从一开始来说;</p>
</li>
<li><p>缓存和tlb</p>
<ul>
<li><p>TLB高速缓存的刷新是内核而不是硬件；</p>
<p>  通常情况来说，进程切换的时候就会让tlb失效；内核在进行cr3变更的时候就会触发这个操作; 下面的几个情况，内核会避免TLB切换:</p>
<ul>
<li>当两个使用相同页表集的普通进程之间执行切换的时候；比如线程的切换</li>
<li>当一个普通进程和一个内核线程间进行切换的时候；因为内核线程是没有自己单独的页表的，而是内核统一的页表；所以切换的时候内核其实还是用进程之前的页表;</li>
</ul>
</li>
</ul>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/29/关于线程、进程、协程的了解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/29/关于线程、进程、协程的了解/" itemprop="url">
                  关于线程、进程、协程的了解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-29T11:02:16+08:00">
                2019-03-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li><p>虚拟地址、物理地址</p>
<p> linux的内存管理模块将物理地址封装到了底层，也就是说物理地址只有操作系统内核在管理，而程序员或者程序本身能获得的地址都是虚拟地址； 这么做的好处是:</p>
<ul>
<li>每一个进程有着独立和相同范围的虚拟地址; 与物理地址的关系有os来管理，每一个进程都会维护一个页表，这就是对应关系;</li>
<li>对权限管理会更加好做，防止进程访问相互的内存地址空间;</li>
</ul>
</li>
<li><p>进程之间的fork</p>
<p> linux的进程通过fork的方式创建子进程，当子进程创建初期，子进程和父进程是一样的；一样主要体现在页表内容是一致的；也就是表示两个进程的虚拟地址指向的物理地址一样的；如果一致一样肯定是不行的；所以当两个进程谁修改了对应的数据，就会以copy-on-write的方式来进行修改，其实本质就是修改虚拟地址指向其他的物理页;</p>
</li>
<li><p>进程描述符(每一个进程的一生的档案)</p>
<p> linux虽有线程概念，其本质依然还是进程，每一个线程都有进程描述符，但是线程与进程的区别在于有一些东西可以共享；每一个进程(线程)都存在一个pid；操作系统为了能更加好管理pid的空闲状态，通常会使用bitmap来保存使用状态；32bit的操作系统，通过会使用一个页来保存这些信息，这些信息会永久的存放在内存中; 64bit就会更加多一些;</p>
<p> 一个进程通常会有多个线程，线程与进程一致会存在pid，那么进程的pid是什么呢？linux中的方式就是将本线程组的pid设置会当前进程的pid，其实进程的pid就是线程组的tgid;</p>
</li>
<li><p>等待队列</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">struct wait_queue_t&#123;</div><div class="line">    unsigned int flags; // 0: 非互斥唤醒(将进程全部唤醒) 1:互斥唤醒(只唤醒一个等待的进程)</div><div class="line">    struct task_struct* task; //唤醒的具体的task</div><div class="line">    wait_queue_func_t func; // 等待队列中的睡眠进程应该用什么方式唤醒；</div><div class="line">    struct list_head task_list; // 等待线程链表</div><div class="line">&#125;</div><div class="line"></div><div class="line">wait_queue_t是等待队列的item;</div></pre></td></tr></table></figure>
<p>进程被阻塞或者等待的过程:</p>
<pre><code>1. 定义wait_queue_t的变量，然后使用init_waitqueue_entry来初始化变量
2. 将等待的变量加入到等待队列中去
3. schedule触发cpu调度
4. 当触发事件完成之后，回归到当前进程的第一件事就是删除等待队列这个变量；
</code></pre><p>wake_up的过程:如果某一个事件发生了,那么内核就会找到对应的等待队列，然后进行唤醒:</p>
<pre><code>1. 获得等待队列表头
2. 轮训队列
3. 如果等待的任务是非互斥的任务就进行唤醒
4. 如果等待的任务是互斥的，并且只是第一次被唤醒的话，那么就推出wake_up

这个任务等待队列有两个前提： 1. 非互斥的任务一定是放在互斥的任务之前 2. 任务可能会被超过一次唤醒，不过我猜应该可能保证是否已经被触发过；
</code></pre><ol>
<li><p>进程切换（重点）</p>
<blockquote>
<p>进程切换、任务切换、context切换是指内核有能力挂起cpu上运行的进程，并恢复以前挂起的某一个进程的执行;</p>
</blockquote>
</li>
</ol>
<pre><code>&gt; cs: 代码段寄存器, ip: 指令指针寄存器，指向cpu下一条要运行的指令或者当前正在执行的指令;


进程切换首先需要了解，切换过程涉及到了什么呢？

* 硬件上下文：主要是指进程在恢复到cpu上运行的时候，必须恢复的寄存器数据; 硬件上下文仅仅只是进程切换的一个子集；这个上下文一部分存放在tss段，一部分存放在内核堆栈上;

    * 进程切换只发生在内核态，在进程进程切换之前，**用户态进程使用的所有寄存器**内容都会保存在**内核态堆栈**上，包括了ss和esp这对寄存器内存; 
    * 进程切换大部分是否是在时间中断的时候被触发，触发的过程会导致进程调度，所以才会只有在内核中存在；

* tss(task state segment): 任务状态段,虽然linux不使用硬件切换，但是强制每一个cpu会创建一个tss，原因:

    * 用户态到内核态切换的时候，可以从tss中获得内核堆栈的地址;
    * 进程IO性能的时候好，可以通过tss获得IO位图来检查权限;

    tss反映了CPU上的当前进程的特权级别; 因为linux不是每个进程一个tss，而是一个cpu一个tss，所以在切换的时候需要保存被替换的硬件上下文,这个和intel的原先设计有点出入;

* 进程描述符的thread字段，linux会被硬件上下文保存在这个字段中;

* Linux的进程切换的schedule函数

    1.切换页全局目录以安装一个新的地址空间
    2.切换内核态堆栈和硬件上下文，因为硬件上下文提供了内核执行新进程的所需要的所有信息，包括cpu寄存器

* switch_to(prev,next,last)

    * prev: 当前进程
    * next: 切换到目标的进程
    * last: 指向当前进程，其实就是prev的内存地址;

    1. 通常切换参数为prev,next,last,调用了switch_to之后这些参数通过压stack的方式保存在内核栈中;
    2. 将prev的内容写入到cpu的eax寄存器
    3. 恢复到next进程的内核栈；**注意注意：由于恢复到了next的内核栈，那么prev其实不在是真正的prev的，而是之前next在调用switch_to被切换出去的时候自己**，所以通过eax来将prev替换
    4. 将prev赋值给last

* switch_to 代码
</code></pre><ul>
<li><p>进程创建</p>
<blockquote>
<p>通用寄存器的值是在从用户态切换到内核态时被保存到内核态堆栈中的;</p>
</blockquote>
<p>  Linux进程创建的优化：</p>
<ul>
<li>子进程复制父进程的资源；并非是完全copy；而是使用了COW的方式进行优化</li>
<li>线程和进程，线程其实就是Linux中轻量级的进程，只不过使用了共享父进程的很多资源来保证高效创建；</li>
<li><p>vfork:共享父进程的内存地址空间，又不具有cow性质;</p>
<p>总结：进程创建过程中，子进程必须要申请的资源是task_struct和对应的内核栈的空间，所以内核栈是每个线程或者进程都会存在一个的; 虽然在空间上是分离的，但是在赋值的时候还是会将父进程的大部分东西赋值给子进程，尤其是在操作过程将描述符的很多字段进行赋值；这个过程中有几点需要明确:</p>
<ul>
<li>描述符进行了赋值、thread也进行了部分赋值；但是esp、eax这些寄存器值确是自己的；因为这        是很重要的,esp指向的是子进程内核, eax是存放系统调用的返回值,因为fork会返回两个值，返回父进程的是子进程的pid，而返回给子进程是0; eip用于存储下一条执行的指令;</li>
<li>执行完clone之后，进程就可以被调度了；当子进程被调度到的时候，就会将内核栈存储的硬件上下文装载到cpu，这样可以是cpu恢复到用户态模式；这个时候父进程和子进程有一些不一样的，1是进程描述符不一样，2. 进程内核栈不一样；3.eax不一样的； 但是代码段是共享的，所以通过eax（返回值不一样）可以判断是子进程还是父进程；虽然大部分的资源是共享的，但是通过修改寄存器的值来保证子进程的运行;</li>
</ul>
</li>
</ul>
</li>
<li><p>内核线程</p>
</li>
</ul>
<p>区别点：</p>
<pre><code>* 内核线程只会运行在内核态；普通进程可以在用户态也可以在内核态
* 内核线程只能访问PAGWE_OFFSET以上的线性地址，而普通线程可以是全部的线性地址；
</code></pre><p>自己的理解可能是这样的，内核线程之间是共享地址空间的；类似于一个进程下面的线程一样，使用了相同的地址空间; 所有的内核线程其实使用了一个地址空间，而且地址空间的范围也是一定的；创建内核线程与普通进程创建是一致的；</p>
<pre><code>* 进程0:所有进程的祖先，这个是linux初始化的时候静态分配的，而其他的进程都是动态分配
* 创建pid为1的进程，然后进程0开始执行cpu idle的函数，这个函数主要是用于没有runing进程的时候就开始执行cpuidle的任务
</code></pre><p>其他的内核线程</p>
<pre><code>* keventd(事件)：执行keventd_wq工作队列
* kaqmq：与电源相关的事件
* kswapd: 执行内存回收
* pdflush: pagecache脏页会写
* kblockd: 执行kblock_workqueue工作队列的函数。它周期性地激活块设备驱动
* ksoftirq: 执行tasklet，每个cpu都有这样的内核线程
</code></pre><ul>
<li><p>进程终止</p>
<p>  当父进程使用wait处理了子进程挂的信号，那么这个时候子进程的最后资源就会被回收，这部分资源主要是集中在进程描述符上面，还有就是thread对象和内核栈</p>
</li>
</ul>
<ul>
<li><p>线程和进程的区别在于：</p>
<ul>
<li>在linux下面线程其实被当作进程处理，有着自己的task_struct结构，只不过线程在创建过程中会共享父进程的内存空间地址;</li>
<li>因为是被当作单独的task来处理，所以线程有着自己的内核栈; 当线程因为某一种关系进入内核的时候需要内核栈来保存硬件上下文(寄存器等值)</li>
<li>线程有着自己的寄存器的值</li>
<li><p>线程有着自己的stack；如果公用主线程的stack就会破坏stack结构;</p>
<p>fork如果创建的是一个子进程，也就说flag没有带上CLONE_VM的话，那么就表示子进程有着自己独立的地址空间，只不过只不过一开始的时候内容是和父进程是一样的；但是但是这过程中有一个页表copy的过程；</p>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/10/整理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/01/10/整理/" itemprop="url">
                  整理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-10T10:11:15+08:00">
                2019-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/interview/" itemprop="url" rel="index">
                    <span itemprop="name">interview</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2018年末2019年初，又开始新的一年面试;昨天晚上面了一个做存储的公司，全程基本上都是被压着问，通过这次面试给我最大的感悟就是基础知识需要扎实，并且要互联起来; 知识点除了要知道还要知道为什么这么设计; 这次面试对基础询问真的很多很多;</p>
<h3 id="1-问题"><a href="#1-问题" class="headerlink" title="1. 问题"></a>1. 问题</h3><ul>
<li>面试题: 对于一个有序数组，找到第一个大于等于目标value的index; </li>
</ul>
<blockquote>
<p>一看就是一个二分法查询的过程，但是我当时脑中一片混乱，实在是不知道怎么办; 这个对二分法需要进行改造，主要是在小于等于中间值的时候，需要去比较前面一个值的大小，如果小那就指定的值，如果大于目标值那就在二分查找一下;</p>
</blockquote>
<ul>
<li><p>C++系列的问题</p>
<ul>
<li><p>new、delete和free、malloc的区别; 为什么对于数组new和delete需要加上<code>[]</code>来做区别</p>
<ol>
<li>new 除了可以在堆上使用，也可以用户自定义内存地址来申请;</li>
<li>new即会申请内存空间也会调用数据类型的构造函数初始化;</li>
<li>为什么数组new需要带上<code>[]</code>, 本质上依然还是需要告诉编译器去调用构造函数; 而delete带有<code>[]</code>则是为了调用析构函数</li>
</ol>
</li>
</ul>
</li>
<li><p>右值引用是什么? 推出的目的又是什么?</p>
</li>
<li>vector的push_back的时间复杂度是多少? O(1), 均摊下来应该是常量</li>
<li><p>C++ 6种内存模型;</p>
<ul>
<li>内存模型用来解决什么问题</li>
<li>具体的区别什么</li>
</ul>
</li>
<li><p>linux的问题</p>
<ul>
<li>进程、线程、协程之前的区别点;<ul>
<li>进程、线程、协程切换上下文切换需要保存哪些信息</li>
</ul>
</li>
<li>load定义</li>
<li>虚拟地址空间的排布</li>
</ul>
</li>
<li><p>网络</p>
<ul>
<li>tcp三次握手和断开的4次握手;  这边深究了一下为什么三次握手需要三次而不是二次或者其他</li>
<li>epoll的作用，实现原理，为什么高效</li>
</ul>
</li>
<li><p>存储</p>
<ul>
<li>介绍一下LSM-Tree结构</li>
<li><p>rocksdb查询过程; </p>
<ul>
<li>假如没有分层会怎么样,都聚集在L0层查询效率会变差很多</li>
<li>compaction的过程？写放大是如何计算方式?</li>
<li>writeBatch的作用</li>
<li>writeBatch的原子性是如何实现的</li>
<li>rocksdb对读优化有哪些   </li>
</ul>
</li>
</ul>
</li>
<li><p>共识</p>
<ul>
<li>raft整体过程</li>
</ul>
</li>
<li><p>事务</p>
<ul>
<li>acid</li>
<li>隔离性的几种</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/12/进程调度之死循环/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/12/进程调度之死循环/" itemprop="url">
                  进程调度之死循环
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-12T22:21:34+08:00">
                2017-04-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这篇文章主要讲的是Linux的进程调度问题，但是能形象的解释其中的一系列的观点，所以找了一个比较经典问题来做载体. 在具体开始之前，先了解一下什么是进程调度呢？</p>
<blockquote>
<p>个人的理解是: 目前操作系统基本都是多任务操作系统，也就是说一个操作系统中存在有多个进程，但是CPU资源是有限的，不能让所有的进程都能一直在运行；所以调度系统就是一个将cpu资源合理分配给各个可运行状态的进程的内核子系统,是多任务操作系统的基础;</p>
</blockquote>
<p>貌似很复杂难懂的调度系统有着一个非常简单的目标: <strong>最大限度利用CPU的处理时间</strong>; 调度系统的基本任务就是: <strong>从多个可运行状态的进程中挑选出一个合适的进程来运行</strong>, 这里的<strong>合适</strong>也是调度系统的核心算法.</p>
<h4 id="1-提问"><a href="#1-提问" class="headerlink" title="1. 提问"></a>1. 提问</h4><p><em>为什么死循环能让CPU利用达到100%呢?</em> </p>
<p>这个问题也是困扰我多年的问题，当然可能就是因为对Linux操作系统的进程调度没有学好才导致这个问题一直困扰我. 针对上面的问题还能引出几个其他的问题?</p>
<ul>
<li>死循环是否会导致系统响应速度下降;</li>
<li></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/07/Linux之进程管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/07/Linux之进程管理/" itemprop="url">
                  Linux进程管理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-07T07:16:14+08:00">
                2017-04-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Linux系统本身没有对线程做出特殊的改造，在Linux中线程本身与创建进程的流程是一样的；唯一与进程的区别是在创建过程中，进程的创建是资源独立的，而线程在创建的过程中，会与其他的进程共享一些资源；所以在Linux中，线程本就是进程，一个有着一点点不同的进程.</p>
<p>Linux中每一个进程都会有一个统一的结构<code>task_struct(进程描述符)</code>, 这个结构包含了进程的所有的信息，包括状态、占有的资源、内存空间等一些; Linux将这些进程描述符放在任务队列中来分别进行调用.</p>
<h4 id="1-进程的状态"><a href="#1-进程的状态" class="headerlink" title="1. 进程的状态"></a>1. 进程的状态</h4><ul>
<li>TASK_RUNNING(运行 or 就绪): 这个状态的进程要不就是正在运行或者在运行队列中等待运行; </li>
<li>TASK_INTERRUPTIBLE(中断): 表示当前进程处于等待状态，直到某一个条件为真或者传递一个信号都能唤醒进程;</li>
<li>TASK_UNINTERRUPTIBLE:与TASK_INTERRUPTIBLE类似，只是这个状态的进程不会因为信号而被唤醒;</li>
<li>TASK_STOPPED:进程执行被暂停，当收到到SIGSTOP、SIGTSTP、SIGTTIN、SIGTTOU等信号的时候;</li>
<li>TASK_ZOMBIE: 进程执行被终止，但是父进程还没有调用wait4或waitpid来收集信息;</li>
<li>TASK_DEAD:进程彻底死亡状态</li>
<li>TASK_TRACED:跟踪状态，用于debug</li>
</ul>
<h4 id="2-进程的创建"><a href="#2-进程的创建" class="headerlink" title="2. 进程的创建"></a>2. 进程的创建</h4><p>上面已经说了，Linux的进程和线程的创建几乎是一模一样的，只是后面会有点点小小的区别;Linux创建进程的过程主要依赖两个系统调用fork+exec; </p>
<h5 id="2-1-fork"><a href="#2-1-fork" class="headerlink" title="2.1 fork"></a>2.1 fork</h5><p>进程调用fork就可以创建子进程；之前的fork是比较粗暴，直接复制所有的资源给子进程，但是这样效率比较低效，因为子进程通过会通过exec来加载另外的程序，那么之前的copy过程就是无用功. 所谓的<code>copy-on-write</code>，就是在调用fork的时候只分配一些进程与进程之间必须独立的资源，比如task_struct结构体、页表(内容是copy父进程的)、内核栈等，其他的资源都是父进程的引用而已;通过这种方式来提高性能.</p>
<p>fork的基本流程是如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">st=&gt;start: 开始</div><div class="line">e=&gt;end: 结束</div><div class="line">fork=&gt;operation: fork</div><div class="line">clone=&gt;operation: clone</div><div class="line">dofork=&gt;operation: do_fork</div><div class="line">dup=&gt;operation: copy一个父进程的进程描述符(比如内核栈、task_struct、thread_info，这些可能是每一个进程所必须的结构)</div><div class="line">setstate=&gt;operation: 设置子进程状态，并且修改进程描述符做区别</div><div class="line">copy=&gt;operation: 根据clone传入的参数来进行资源copy</div><div class="line">run=&gt;operation: 平分时间片，然后将子进程唤醒</div><div class="line"></div><div class="line">st-&gt;fork-&gt;clone-&gt;dofork-&gt;dup-&gt;setstate-&gt;copy-&gt;run-&gt;e</div></pre></td></tr></table></figure>
<h5 id="2-2-关于Linux中的线程"><a href="#2-2-关于Linux中的线程" class="headerlink" title="2.2 关于Linux中的线程"></a>2.2 关于Linux中的线程</h5><p>上面说了，Linux的线程其实就是linux的进程，只是在创建的时候传给<code>clone</code>函数的参数上有一些不一样的; </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">clone(CLONE_VM | CLONE_FS | CLONE_FILES | CLONE_SIGHAND, 0);</div></pre></td></tr></table></figure>
<p>线程在创建的时候通过传入以上的几个参数，这可能就是与进程创建区别了，这样创建的进程与父进程是共享地址空间、文件系统、打开的文件、信号处理函数；所以从这看出，Linux所谓的线程本质其实就是进程。</p>
<h5 id="2-3-内核线程-Kernal-thread"><a href="#2-3-内核线程-Kernal-thread" class="headerlink" title="2.3 内核线程(Kernal thread)"></a>2.3 内核线程(Kernal thread)</h5><p>内核线程与普通的进程的区别在于</p>
<pre><code>* 内核线程没有独立的地址空间
* 只运行在内核态，从不切换到用户态
</code></pre><p>其他是类似的，可以被抢占，也可以被调度;</p>
<h4 id="3-进程死亡"><a href="#3-进程死亡" class="headerlink" title="3. 进程死亡"></a>3. 进程死亡</h4><p>每一个进程总会面临死亡的过程，那么进程的死亡要经过哪几个步骤呢？一个进程的创建的过程是赋予资源，那么进程死亡就是归还资源的过程;</p>
<p>什么时候进程会面临终结呢? 显示的调用了<code>exit()</code>这个系统调用，或者是被动总结，不管怎么样触发，这个过程都有<code>do_exit</code>完成;</p>
<ul>
<li>释放各种资源</li>
<li>设置进程的状态为TASK_ZOMBIE</li>
<li>发送信号给父进程，说我快终结了</li>
<li>调用schedule函数，主动的放弃cpu</li>
</ul>
<p>到此为止，进程已经释放了大部分的资源，不过还保存着进程描述符、内核栈、thread_info等一些必要的数据结构，直到父进程调用<code>wait4()</code>系统收集子进程的一些状态，那么这进程就真正的终结;Linux将资源清理与进程描述符清理分开执行;</p>
<h4 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h4><ul>
<li>进程状态</li>
<li>Linux 进程与线程是同样的东西;</li>
<li>进程的创建与死亡</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/04/scylladb-官文安装译文/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/04/scylladb-官文安装译文/" itemprop="url">
                  scylladb 官文安装译文
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-04T19:56:06+08:00">
                2017-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/scylladb/" itemprop="url" rel="index">
                    <span itemprop="name">scylladb</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>主要的依赖于官方的教程，这边主要是将一些细节进行串联描述，下次安装的时候会更加自动化;</p>
<p>我的安装环境如下：</p>
<ul>
<li>centos7.2</li>
<li>内核版本为3.18</li>
</ul>
<h4 id="1-关于scylladb几个rpm的介绍"><a href="#1-关于scylladb几个rpm的介绍" class="headerlink" title="1. 关于scylladb几个rpm的介绍"></a>1. 关于scylladb几个rpm的介绍</h4><ul>
<li>scylla-server(standard):scylladb主要的server端</li>
<li>scylla-server(debuginfo):scylladb server端并且带有debuginfo</li>
<li>scylla-jmx: 兼容cassandra通过jmx端口进行访问</li>
<li>scylla-tools: scylla为了兼容cassandra而提供的类似的功能:<ul>
<li>nodetool:很强大的功能，用来观察集群状态</li>
<li>cqlsh:</li>
<li>cassandra-stress:压测工具</li>
</ul>
</li>
</ul>
<h4 id="2-前期准备"><a href="#2-前期准备" class="headerlink" title="2.前期准备"></a>2.前期准备</h4><ul>
<li>删除abrt,主要是这个与scylladb本身的coredump配置冲突; <code>yum remove -y abrt</code></li>
<li>必须有sudo权限</li>
<li>预安装的东西, <code>yum install -y wget epel-release</code>, <code>epel-release</code>是一个fedora维护的软件仓库，全名叫做<em>企业版Linux额外软件包</em></li>
</ul>
<h4 id="3-正式开始装"><a href="#3-正式开始装" class="headerlink" title="3. 正式开始装"></a>3. 正式开始装</h4><ul>
<li>下载最新的scylladb源，由于每次更新源都会有一定的变化，所以每一次更新的时候最好要更新一下源;下面的源是1.4版本的</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo wget -O /etc/yum.repos.d/scylla.repo http://downloads.scylladb.com/rpm/centos/scylla-1.4.repo</div></pre></td></tr></table></figure>
<ul>
<li><p>是scylla yum源生效; <code>yum clean all; yum makecache</code></p>
</li>
<li><p>安装scylla; <code>yum install -y scylla</code></p>
</li>
</ul>
<p>如果一些顺利的话，到这一步scylladb就已经安装完毕了</p>
<h4 id="4-配置和脚本相关的"><a href="#4-配置和脚本相关的" class="headerlink" title="4. 配置和脚本相关的"></a>4. 配置和脚本相关的</h4><table>
<thead>
<tr>
<th>配置名字</th>
<th>配置作用</th>
<th>配置位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>scylladb的主要配置</td>
<td>设定一些主要的参数，比如存储位置、开放端口和ip，也会有一些性能参数设置</td>
<td>/etc/scylla/scylla.yaml</td>
</tr>
<tr>
<td>scylla启动脚本</td>
<td></td>
<td>/etc/sysconfig/scylla-server</td>
</tr>
<tr>
<td>系统资源限制</td>
<td>去掉对scylla用户的资源限制</td>
<td>/etc/security/limits.d/scylla.conf</td>
</tr>
<tr>
<td>启动脚本</td>
<td>设置参数、启动scylladb脚本</td>
<td>/etc/sysconfig/scylla-server</td>
</tr>
<tr>
<td>coredump配置文件</td>
<td>设置coredump的配置文件</td>
<td>/etc/sysconfig/sysctl.d/99-scylla.conf</td>
</tr>
<tr>
<td>collectd配置文件</td>
<td>设置collectd的一些配置</td>
<td>/etc/collectd.d/scylla.conf</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>配置名字</th>
<th>配置作用</th>
<th>配置位置</th>
</tr>
</thead>
<tbody>
<tr>
<td>内核设置</td>
<td>在bootloader中设置内核参数</td>
<td>/usr/lib/scylla/scylla_bootparam_setup</td>
</tr>
<tr>
<td>coredump配置文件生成器</td>
<td></td>
<td>/usr/lib/scylla/scylla_coredump_setup</td>
</tr>
<tr>
<td>ntp协议配置生成器</td>
<td></td>
<td>/usr/lib/scylla/scylla_ntp_setup</td>
</tr>
<tr>
<td>网络配置设定</td>
<td></td>
<td>/usr/lib/scylla/scylla_prepare</td>
</tr>
<tr>
<td>配置raid和文件系统的脚本</td>
<td></td>
<td>/usr/lib/scylla/scylla_raid_setup</td>
</tr>
<tr>
<td>压缩coredump脚本</td>
<td>only ubuntu有效</td>
<td>/usr/lib/scylla/save_coredump</td>
</tr>
<tr>
<td>重新设置网络模式</td>
<td>如果scylladb运行的virtio或者DPDK的话，就重新设置网络模式</td>
<td>/usr/lib/scylla/scylla_stop</td>
</tr>
<tr>
<td>重新设置网络参数</td>
<td></td>
<td>/usr/lib/scylla/posix_net_conf.sh</td>
</tr>
<tr>
<td>io.conf生成器</td>
<td>用于测试io性能，并且把文件提供给scylladb</td>
<td>/usr/lib/scylla/scylla_io_setup </td>
</tr>
</tbody>
</table>
<p>上面这些脚本都是在<code>/usr/lib/scylla</code>目录下面的，并且还有其他的脚本，这些脚本会在运行scylla_setup的时候会调用;详情请看<a href="http://www.scylladb.com/doc/system-configuration/" target="_blank" rel="external">url</a></p>
<table>
<thead>
<tr>
<th>作用</th>
<th>端口值</th>
</tr>
</thead>
<tbody>
<tr>
<td>cql</td>
<td>9042</td>
</tr>
<tr>
<td>内部rpc</td>
<td>7000</td>
</tr>
<tr>
<td>ssl内部rpc</td>
<td>7001</td>
</tr>
<tr>
<td>jmx 端口</td>
<td>7199</td>
</tr>
<tr>
<td>scylla rest api</td>
<td>10000</td>
</tr>
<tr>
<td>Scylla Prometheus API(不知道是什么)</td>
<td>9180</td>
</tr>
<tr>
<td>node_exporter</td>
<td>9100</td>
</tr>
</tbody>
</table>
<h4 id="5-具体的配置"><a href="#5-具体的配置" class="headerlink" title="5. 具体的配置"></a>5. 具体的配置</h4><table>
<thead>
<tr>
<th>配置项</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>seeds</td>
<td>种子ip列表，建议多几个ip</td>
</tr>
<tr>
<td>listen_address</td>
<td>scylladb内部通信的ip</td>
</tr>
<tr>
<td>rpc_address</td>
<td>客户端连接scylladb的ip</td>
</tr>
<tr>
<td>broadcast_address</td>
<td>默认listen_address，从其他节点角度看这个node的ip，可能是不同网络之间不同，而通过外网来进行互联</td>
</tr>
<tr>
<td>broadcast_rpc_address</td>
<td>默认是rpc_address,从client角度上来你应该是什么ip，同上</td>
</tr>
</tbody>
</table>
<h4 id="6-scylladb管理命令"><a href="#6-scylladb管理命令" class="headerlink" title="6. scylladb管理命令"></a>6. scylladb管理命令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>scylla –version</td>
<td>查看版本</td>
</tr>
<tr>
<td>nodetool snapshot</td>
<td>将node数据进行快照;关于scylladb snapshot的原理是：通过linux的hardlink来进行备份，因为scylladb的文件产生之后会不会改变所以这样能很好的保证备份的作用，并且用来了hardlink保证文件的可用性，和不需要通过拷贝也加重系统的负载;</td>
</tr>
<tr>
<td>恢复备份</td>
<td>1. 清空commitlog 2. 清空data目录下面的数据文件 3. 把snapshot备份的文件mv过来即可 4. 重启</td>
</tr>
<tr>
<td>提供rest接口</td>
<td></td>
</tr>
<tr>
<td>scyllatop</td>
<td>scylla自己的top, 目测可以与collectd一起使用，并且提供比较好的功能</td>
</tr>
<tr>
<td>Prometheus</td>
<td>scylla自己的监控系统</td>
</tr>
<tr>
<td>collectd</td>
<td>scylladb本地会启动collectd的进程，用来接收scylladb抛送过来的数据，可以通过插件的方式来修改，比较方便，并且会增加scyllatop看到的数据</td>
</tr>
<tr>
<td>log</td>
<td>scylla log是通过centos7的 journalctl 来控制的；最常用的有<code>journalctl _COMM=scylla -p warning</code> 或者 <code>journalctl _COMM=scylla --since &quot;2015-01-10&quot; --until &quot;2015-01-11 03:00</code> 或者 <code>journalctl _COMM=scylla -b(从最近一次重启的日志)</code></td>
</tr>
</tbody>
</table>
<p>node tool命令介绍</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>nodetool status</td>
<td>看集群的状态,<a href="http://www.scylladb.com/doc/nodetool-commands/status/" target="_blank" rel="external">详情</a></td>
</tr>
<tr>
<td>nodetool snapshot</td>
<td>上面已提过</td>
</tr>
<tr>
<td>nodetool cfhistograms</td>
<td>提供每一个表的静态数据，包括sstable的个数、读写延迟、分区的尺寸和列簇的个数;<code>nodetoll sfhistograms keyspace tablename</code>,<a href="http://www.scylladb.com/doc/nodetool-commands/cfhistograms/" target="_blank" rel="external">详情</a></td>
</tr>
<tr>
<td>nodetool cfstats</td>
<td>提供对特定的表的一个深层的分析;<code>nodetool cfstats keyspace.tablename</code>,<a href="http://www.scylladb.com/doc/nodetool-commands/cfstats/" target="_blank" rel="external">详情</a></td>
</tr>
<tr>
<td>nodetool cleanup</td>
<td>立即触发清理不属于本机的key；<code>nodetool cleanup -h 127.0.0.1 keyspace</code></td>
</tr>
<tr>
<td>nodetool clearsnapshot</td>
<td>清理snapshot文件,<code>nodetool clearsnapshot keyspace</code>,不写keyspace就默认删除全部的snapshot </td>
</tr>
<tr>
<td>compactionhistory</td>
<td>打印compact的历史</td>
</tr>
<tr>
<td>compactionstats</td>
<td>打印目前正在compact的进度和一些信息</td>
</tr>
<tr>
<td>compact</td>
<td>对可能的keyspac而进行强制的compact操作; <code>nodetool compact keyspace</code></td>
</tr>
<tr>
<td>describecluster</td>
<td>打印一些信息</td>
</tr>
<tr>
<td>decommission</td>
<td></td>
</tr>
<tr>
<td>describering</td>
<td>打印某一个keyspace的一致性hash分布情况</td>
</tr>
<tr>
<td>disablebackup</td>
<td>关闭增量备份</td>
</tr>
<tr>
<td>disablebinary</td>
<td>关闭cql</td>
</tr>
<tr>
<td>statusbinary</td>
<td>看cql当前运行的状态</td>
</tr>
<tr>
<td>enablebinary</td>
<td>开启cql</td>
</tr>
<tr>
<td>statusgossip</td>
<td>gossip协议的运行状态</td>
</tr>
<tr>
<td>disablegossip</td>
<td>关闭gossip</td>
</tr>
<tr>
<td>enablegossip</td>
<td>开启gossip</td>
</tr>
<tr>
<td>drain</td>
<td>通常用于升级scylladb之前使用，主要的操作是将所有的memtable全部写入到sstable，然后停止listen各种端口，之后要恢复必须通过重启</td>
</tr>
<tr>
<td>flush</td>
<td>将当然的memtable刷成sstable</td>
</tr>
<tr>
<td>getendpoints</td>
<td><code>nodetool getendpoints keyspace tablename key</code>,现在还不知道用来做什么</td>
</tr>
<tr>
<td>getlogginglevels</td>
<td>获得运行时中的日志等级</td>
</tr>
<tr>
<td>gossipinfo</td>
<td>展示gossip协议中传播的东西</td>
</tr>
<tr>
<td>info</td>
<td>展现当前节点的一些信息; <a href="http://www.scylladb.com/doc/nodetool-commands/info/" target="_blank" rel="external">详情</a></td>
</tr>
<tr>
<td>listsnapshots</td>
<td>展示所有的snapshot在磁盘上的占用率</td>
</tr>
<tr>
<td>move</td>
<td>将node 分配到新的token</td>
</tr>
<tr>
<td>netstats</td>
<td>打印一些网络信息</td>
</tr>
<tr>
<td>proxyhistograms</td>
<td>对于网络操作打印一些静态统计</td>
</tr>
<tr>
<td>rebuild <src-dc-name></src-dc-name></td>
<td>从另外一个节点重建数据</td>
</tr>
<tr>
<td>refrash <keyspace> <tablename></tablename></keyspace></td>
<td>在不重启的前提下，重新reload文件中的sstable</td>
</tr>
<tr>
<td>removenode <id></id></td>
<td>移除名为id的节点</td>
</tr>
<tr>
<td>repair</td>
<td>修复一个或者多个的列簇； 参数比较多，使用前查询;</td>
</tr>
<tr>
<td>ring</td>
<td>显示一致性hash的列表</td>
</tr>
<tr>
<td>setlogginglevel <class> <threshold></threshold></class></td>
<td>设置某一个类的运行时日志等级</td>
</tr>
<tr>
<td>settraceprobability – <value></value></td>
<td>设置跟踪请求的概率，value在0~1之间</td>
</tr>
<tr>
<td>snapshot [-t tag] [-cf tablename] <keyspace></keyspace></td>
<td>针对具体的表或keyspace做快照</td>
</tr>
<tr>
<td>statusbackup</td>
<td>增量backup的状态</td>
</tr>
<tr>
<td>stop</td>
<td>停止compact任务</td>
</tr>
<tr>
<td>version</td>
<td>db的版本  </td>
</tr>
</tbody>
</table>
<p>nodetool info几个参数介绍</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gossip active</td>
<td>gossip状态</td>
</tr>
<tr>
<td>Thrift active</td>
<td>thrift 状态</td>
</tr>
<tr>
<td>native transport active</td>
<td>cql的状态</td>
</tr>
<tr>
<td>Load</td>
<td>sstable占磁盘多少空间</td>
</tr>
<tr>
<td>Generation NO</td>
<td>主版本，当节点重启、token更新，这个版本就会往上增加</td>
</tr>
<tr>
<td>Uptime</td>
<td>scylla没有这个</td>
</tr>
<tr>
<td>Heap Memory</td>
<td>scylla没有这个</td>
</tr>
<tr>
<td>off Heap memory (MB)</td>
<td>所有的memtables、bloom filters 、indexs、compression metadata占用的内存</td>
</tr>
<tr>
<td>Data center</td>
<td>这个节点所在的数据中心</td>
</tr>
<tr>
<td>Rack</td>
<td>？？、</td>
</tr>
<tr>
<td>Exception</td>
<td>scylla没有这个</td>
</tr>
<tr>
<td>Key Cache</td>
<td>scylla没有这个</td>
</tr>
<tr>
<td>Row Cache</td>
<td>Row cache的信息</td>
</tr>
<tr>
<td>Counter Cache</td>
<td>scylla没有这个</td>
</tr>
<tr>
<td>Token</td>
<td>token展示</td>
</tr>
</tbody>
</table>
<h4 id="7-关于scylladb的monitor安装-由于官方教程变化太大-以官方为准"><a href="#7-关于scylladb的monitor安装-由于官方教程变化太大-以官方为准" class="headerlink" title="7. 关于scylladb的monitor安装[由于官方教程变化太大,以官方为准]"></a>7. 关于scylladb的monitor安装[由于官方教程变化太大,以官方为准]</h4><p>目前scylladb的监控是使用<a href="https://github.com/scylladb/scylla-grafana-monitoring" target="_blank" rel="external">Grafana and Prometheus
</a>, 具体的安装过程如下:</p>
<ol>
<li>首先安装docker在服务器上; <code>sudo yum install -y docker</code></li>
<li>启动docker服务;<code>sudo service docker start</code></li>
<li>验证docker安装情况; <code>sudo docker ps -a or sudo docker images</code></li>
</ol>
<p>其实监控安装比较简单，但是由于网络问题安装就变成很蛋疼的过程;</p>
<ul>
<li>首先通过mac翻墙下载docker 镜像; prom/prometheus and grafana/grafana</li>
</ul>
<pre><code>docker pull prom/prometheus:v1.5.2
docker pull grafana/grafana:4.1.1
</code></pre><ul>
<li>将镜像导出成tar格式的文件</li>
</ul>
<pre><code>docker save imageid -o xxx.tar
</code></pre><p>镜像id可以通过<code>docker images</code>来得到</p>
<pre><code>$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
grafana/grafana     latest              a892c250adfa        11 days ago         266.2 MB
prom/prometheus     latest              bdeacb538ef9        2 weeks ago         79.25 MB
</code></pre><ul>
<li>将tar文件上传到服务器，然后导入服务器的docker</li>
</ul>
<pre><code>docker load -i xxx.tar
#修改对应的name和版本
docker tag imageId name:tag

sudo docker tag  047fd14b7251 prom/prometheus:v1.0.0
sudo docker tag d7528263f75a grafana/grafana:3.1.0
</code></pre><ul>
<li>下载 scylla-grafana-monitoring 项目</li>
</ul>
<pre><code>git clone https://github.com/scylladb/scylla-grafana-monitoring.git
</code></pre><ul>
<li>修改prometheus的配置文件</li>
</ul>
<pre><code>global:
# 采集周期
  scrape_interval: 15s # By default, scrape targets every 15 seconds.

  # Attach these labels to any time series or alerts when communicating with
  # external systems (federation, remote storage, Alertmanager).
  external_labels:
    monitor: &apos;scylla-monitor&apos;

scrape_configs:
    - job_name: scylla
  honor_labels: true
  static_configs:
  # 这个是scylladb服务的地址，这边是主动采集为主，不是被动上报，主要收集scylla的metric信息
      - targets: [&quot;10.19.11.23:9180&quot;]
    - job_name: node_exporter
  honor_labels: true
  static_configs:
  # 这部分主要是收集scylla的机器的信息，需要通过node_exporter 来开启这个上报;
      - targets: [&apos;10.19.11.23:9100&apos;]

## two servers example: - targets: [&quot;172.17.0.3:9103&quot;,&quot;172.17.0.2:9103&quot;]
</code></pre><ul>
<li>用启动脚本启动</li>
</ul>
<pre><code>sudo sh start-all.sh -d data_dir -v 1.6
</code></pre><p>data路径最好要配置一个，不然两次启动会把数据删除<br>-v: 用来表示加载哪个系统版本</p>
<p>这个可能会碰到一个问题，</p>
<pre><code>598cf3f9e16f0e5df2a1f0cf79df8be2ee0909f80307e392911d140b2ff6dac8
Wait for Prometheus container to start..        4721e32c86ea09f1e16d270a194eb979cbf61f249c066435234e7d5cafee8631
Wait for Grafana container to start........curl: (7) Failed connect to localhost:3000; Connection refused
curl: (7) Failed connect to localhost:3000; Connection refused
curl: (7) Failed connect to localhost:3000; Connection refused        curl: (7) Failed connect to localhost:3000; Connection refused
</code></pre><p>Grafana 没有起来 或者起来，但是还没有监听端口，然后脚本最多只是重试7次，这个时候就会报错，其实后期grafana是成功起来的；</p>
<p>解决方式有两个：</p>
<pre><code>1. 先执行脚本，然后等到grafana起来，然后关掉prometheus,然后修改start-all.sh中的脚本，把docker run grafana那个部分去掉，然后在执行start-all.sh, 这样就ok了
2. 将重试几次增大
</code></pre><ul>
<li>关闭监控</li>
</ul>
<pre><code>sudo sh kill-all.sh
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/27/为新的jmxtrans添加新的outputwriter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/27/为新的jmxtrans添加新的outputwriter/" itemprop="url">
                  为新的jmxtrans添加新的outputwriter
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-27T21:52:00+08:00">
                2017-03-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kafka/" itemprop="url" rel="index">
                    <span itemprop="name">kafka</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://github.com/jmxtrans/jmxtrans" target="_blank" rel="external">jmxtrans</a>是一个开源产品，主要的作用是通过定时轮训程序的jmx端口来获得程序内部的信息，并且输出到对应的外界监控系统，比如ganglia、es、influxdb等；由于它的这种作用，所以不少的人将它使用在对一些开源组件的监控. 而我主要用它来将kafka中的broker信息输出到我们内部的监控。</p>
<p>年前已经将监控信息输出到了ganglia，但是这不能与我们的报警系统好好的融合起来，我基本不可能时时刻刻盯着监控图标在看的，为此所以我就必须将让kafka的监控数据输出到我们内部的监控，并且对一些特定的metric设置报警，这样就可以对kafka内部的一些状态进行监控，也能更加快的发现问题。</p>
<h4 id="1-安装一个稳定版本的jmxtrans"><a href="#1-安装一个稳定版本的jmxtrans" class="headerlink" title="1. 安装一个稳定版本的jmxtrans"></a>1. 安装一个稳定版本的jmxtrans</h4><p>jmxtrans提供了rpm包，你可以直接通过如下命令来安装；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ivh jmxtrans-260.rpm</div></pre></td></tr></table></figure>
<p>安装完之后，jmxtrans会在几个目录存放对应的配置文件、日志、pid等，对此我也是很纠结，就不能想其他的程序一样放的正规一点吗，几个目录还不在一起;</p>
<ul>
<li>/var/log/jmxtrans/jmxtrans.log: jmxtrans运行的日志</li>
<li>/var/run/jmxtrans/jmxtrans.pid: 存放jmxtrans对应的pid</li>
<li>/usr/shared/jmxtrans/:这个目录下面存放的jmxtrans的库文件、可执行文件、一些jmx的配置</li>
<li>/var/lib/jmxtrans/:这个目录下面存放的需要采集的配置文件，通常是json;</li>
</ul>
<h4 id="2-下载对应版本的jmxtrans"><a href="#2-下载对应版本的jmxtrans" class="headerlink" title="2. 下载对应版本的jmxtrans"></a>2. 下载对应版本的jmxtrans</h4><p>我使用的260版本的jmxtrans，于是我从它们的github网址下载了源码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/jmxtrans/jmxtrans/archive/jmxtrans-parent-260.tar.gz</div></pre></td></tr></table></figure>
<p>然后用intellij打开对应的工程;</p>
<h4 id="3-添加自己的outputwriter"><a href="#3-添加自己的outputwriter" class="headerlink" title="3. 添加自己的outputwriter"></a>3. 添加自己的outputwriter</h4><p>这个部分我就大概说一下，具体可以看<code>jmxtrans-output-log4j中KeyOutWriter</code>这个类，因为很简单，很快就模拟然后进行自己的改造;</p>
<ul>
<li>创建自己的outputwriter模块，比如我就自己在jmxtrans-output创建了一个<code>jmxtrans-output-sentry</code>模块，pom.xml只需要将对应的依赖加上的，记得一定会依赖如下几个依赖:</li>
</ul>
<pre><code>&lt;dependency&gt;
   &lt;groupId&gt;org.jmxtrans&lt;/groupId&gt;
   &lt;artifactId&gt;jmxtrans-core&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
   &lt;groupId&gt;org.jmxtrans&lt;/groupId&gt;
   &lt;artifactId&gt;jmxtrans-utils&lt;/artifactId&gt;
&lt;/dependency&gt; 
&lt;dependency&gt;
   &lt;groupId&gt;org.jmxtrans&lt;/groupId&gt;
   &lt;artifactId&gt;jmxtrans-test-utils&lt;/artifactId&gt;
   &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre><ul>
<li><p>创建你自己的outputwriter类，并且继承<code>BaseOutputWriter</code>;下面的代码中我把公司内部的代码给去掉了，但是其实是一个很简单的输出端，不影响整个过程，下面的循环就对应的后面配置中的每一次你需要的查询；代码中的<code>metric</code> 和 <code>value</code>就是对应的key和value;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">	public class SentryOutWriter extends BaseOutputWriter &#123;</div><div class="line">    private static Logger logger = LoggerFactory.getLogger(SentryOutWriter.class);</div><div class="line">    private Map&lt;String, String&gt; fixTags = new HashMap&lt;&gt;();</div><div class="line">    private String clustername;</div><div class="line"></div><div class="line">    @JsonCreator</div><div class="line">    public SentryOutWriter(@JsonProperty(&quot;typeNames&quot;) ImmutableList&lt;String&gt; typeNames,</div><div class="line">                           @JsonProperty(&quot;booleanAsNumber&quot;) boolean booleanAsNumber,</div><div class="line">                           @JsonProperty(&quot;debug&quot;) Boolean debugEnabled,</div><div class="line">                           @JsonProperty(&quot;settings&quot;) Map&lt;String, Object&gt; settings,</div><div class="line">                           @JsonProperty(&quot;clustername&quot;) String clustername) &#123;</div><div class="line">        super(typeNames, booleanAsNumber, debugEnabled, settings);</div><div class="line">        logger.info(&quot;SentryOutWriter is init&quot;);</div><div class="line"></div><div class="line">        this.clustername = clustername;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void validateSetup(Server server, Query query) throws ValidationException &#123;&#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void internalWrite(Server server, Query query, ImmutableList&lt;Result&gt; results) throws Exception &#123;</div><div class="line">        List&lt;String&gt; typeNames = getTypeNames();</div><div class="line">        long now = System.currentTimeMillis()/1000;</div><div class="line">        for (Result result : results) &#123;</div><div class="line">            Map&lt;String, Object&gt; resultValues = result.getValues();</div><div class="line">            for (Map.Entry&lt;String, Object&gt; values : resultValues.entrySet()) &#123;</div><div class="line">                if (isNumeric(values.getValue())) &#123;</div><div class="line">                    String mbeanAlias = Util.getMBeanIdentifier(query, result);</div><div class="line">                    String key = Util.getKeyString(query, result, values);</div><div class="line"></div><div class="line">                    if(Strings.isNullOrEmpty(mbeanAlias) || Strings.isNullOrEmpty(key))&#123;</div><div class="line">                        continue;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    String metric = mbeanAlias + &quot;.&quot; + key;</div><div class="line">                    Double value = null;</div><div class="line">                   </div><div class="line">                    if(values.getValue() instanceof Double)&#123;</div><div class="line">                          value = (Double) values.getValue();</div><div class="line">                    &#125;else if(values.getValue() instanceof Long)&#123;</div><div class="line">                        value = Double.valueof((Long) values.getValue());</div><div class="line">                    &#125;else if(values.getValue() instanceof Integer) &#123;</div><div class="line">                        value = Long.valueOf((Integer)values.getValue());</div><div class="line">                    &#125; else if(values.getValue() instanceof String)&#123;</div><div class="line">                        value = Double.valueOf((String)values.getValue());</div><div class="line">                    &#125;else&#123;</div><div class="line">                        try&#123;</div><div class="line">                            value =  Double.valueOf((Double)values.getValue());</div><div class="line">                        &#125;catch (Exception e)&#123;</div><div class="line">                            logger.error(&quot;to double is error,&#123;&#125;&quot;, e);</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    logger.error(&quot;metrci:&#123;&#125;&quot;, metric);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>将你自己的模块打包</li>
</ul>
<h4 id="4-将你的包导入的之前已经安装完的稳定版本中"><a href="#4-将你的包导入的之前已经安装完的稳定版本中" class="headerlink" title="4. 将你的包导入的之前已经安装完的稳定版本中"></a>4. 将你的包导入的之前已经安装完的稳定版本中</h4><p>其实jmxtrans没有提供很好的方式可以将自定义的包放到它们的stable版本中，起码我没有很好的方式；但是在模仿其他包的时候我还是发现了一些可行的方式来导入自己的包；</p>
<ol>
<li><p>确定你的jar依赖的其他的jar包；</p>
<p> 因为你自定义的jar可能还依赖出jmxtrans本身的其他的jar，所以你实现应该确定好有哪些jar包需要额外依赖；比如我就额外的包就是我司内部的监控client jar包;</p>
</li>
<li><p>将你的包上传到jmxtrans的服务端</p>
<ul>
<li>/usr/shared/jmxtrans/lib/这目录下面就是用来存放对应的jar包的,其中<code>/usr/share/jmxtrans/lib/org/jmxtrans</code>就是用来存放对应输出端的jar，所以你要把你自定的jar包放在这里;比如我就放在<code>/usr/share/jmxtrans/lib/org/jmxtrans/jmxtrans-output-sentry/260/</code>下面，jar包名字叫做<code>jmxtrans-output-sentry-260.jar</code></li>
<li>上传额外依赖包，按照标准的方式存放即可，lib目录下面有很多的例子可以模仿</li>
</ul>
</li>
<li><p>修改wrapper.conf文件</p>
<p> <code>/usr/share/jmxtrans/etc/wrapper.conf</code>是jmxtrans的启动配置文件，里面包含了启动需要加载那些包，所以需要添加jar的依赖;</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wrapper.java.classpath.89=%REPO_DIR%/org/slf4j/slf4j-log4j12/1.7.21/slf4j-log4j12-1.7.21.jar</div><div class="line">wrapper.java.classpath.90=%REPO_DIR%/org/jmxtrans/jmxtrans-output-sentry/260/jmxtrans-output-sentry-260.jar</div><div class="line">wrapper.java.classpath.91=%REPO_DIR%/com/xxxx/xxxx/xxx.jar</div></pre></td></tr></table></figure>
<ol>
<li><p>去修改<code>/var/lib/jmxtrans/kafka.json</code>修改outputwriter的类型</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div></pre></td><td class="code"><pre><div class="line">	&#123;</div><div class="line">  &quot;servers&quot;: [</div><div class="line">    &#123;</div><div class="line">      &quot;port&quot;: &quot;your sever jmx port&quot;,</div><div class="line">      &quot;host&quot;: &quot;your server ip&quot;,</div><div class="line">      &quot;queries&quot;: [</div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;java.lang:type=Memory&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;memory&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;HeapMemoryUsage&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;java.lang:type=GarbageCollector,name=G1 Old Generation&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;FullGC&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;CollectionCount&quot;,</div><div class="line">            &quot;CollectionTime&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;MessagesIn&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;BytesIn&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;BytesOut&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestsPerSec,request=Produce&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;ProduceRequests&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestsPerSec,request=FetchConsumer&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;FetchConsumerRequests&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestsPerSec,request=FetchFollower&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;FetchFollowerRequests&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.log:type=LogFlushStats,name=LogFlushRateAndTimeMs&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;LogflushRateAndTime&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;OneMinuteRate&quot;,</div><div class="line">            &quot;999thPercentile&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.log:type=ReplicaManager,name=UnderReplicatedPartitions&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;UnISRPartitionCnt&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;Value&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.controller:type=KafkaController,name=ActiveControllerCount&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;ActiveControllerCnt&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;Value&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.controller:type=ControllerStats,name=LeaderElectionRateAndTimeMs&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;LeaderRateAndTime&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;999thPercentile&quot;,</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.controller:type=ControllerStats,name=UncleanLeaderElectionsPerSec&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;UncleanLeaderRateAndTime&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;999thPercentile&quot;,</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.server:type=ReplicaManager,name=PartitionCount&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;PartitionCnt&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;Value&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.server:type=ReplicaManager,name=LeaderCount&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;LeaderCnt&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;Value&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.server:type=DelayedOperationPurgatory,name=PurgatorySize,delayedOperation=Produce&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;ProducerPurgatorySize&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;Value&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.server:type=DelayedOperationPurgatory,name=PurgatorySize,delayedOperation=Fetch&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;FetchPurgatorySize&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;Value&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestQueueTimeMs,request=FetchConsumer&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;FetchConsumerWait&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;999thPercentile&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestQueueTimeMs,request=Produce&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;ProduceWait&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;999thPercentile&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=LocalTimeMs,request=FetchConsumer&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;FetchConsumerProcessTime&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;999thPercentile&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=LocalTimeMs,request=Produce&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;ProduceProcessTime&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;999thPercentile&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.server:type=SessionExpireListener,name=ZooKeeperDisconnectsPerSec&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;ZKDisConnectCnt&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          &quot;outputWriters&quot;: [</div><div class="line">            &#123;</div><div class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</div><div class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</div><div class="line">            &#125;</div><div class="line">          ],</div><div class="line">          &quot;obj&quot;: &quot;kafka.server:type=SessionExpireListener,name=ZooKeeperExpiredPerSec&quot;,</div><div class="line">          &quot;resultAlias&quot;: &quot;ZKExpiredCnt&quot;,</div><div class="line">          &quot;attr&quot;: [</div><div class="line">            &quot;OneMinuteRate&quot;</div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      ],</div><div class="line">      &quot;numQueryThreads&quot;: 1</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h4><p>这样就可以把数据输出到我自己的监控;关于kafka的监控信息可以看<a href="http://andrewrong.github.io/2017/03/26/kafka-broker%E7%9A%84%E7%9B%91%E6%8E%A7%E4%BF%A1%E6%81%AF/" target="_blank" rel="external">这篇文章</a>，有什么问题可以通过<a href="https://twitter.com/andrew_rong" target="_blank" rel="external">twitter</a>私信给我;</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/26/kafka-broker的监控信息/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="nomoshen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="nomoshen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/26/kafka-broker的监控信息/" itemprop="url">
                  kafka broker的监控信息
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-26T21:35:09+08:00">
                2017-03-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kafka/" itemprop="url" rel="index">
                    <span itemprop="name">kafka</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-broker的监控信息"><a href="#1-broker的监控信息" class="headerlink" title="1. broker的监控信息"></a>1. broker的监控信息</h3><table>
<thead>
<tr>
<th>标题</th>
<th>mbean name</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>Message in rate</td>
<td><code>kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec</code></td>
<td>当前broker每秒的消息个数</td>
</tr>
<tr>
<td>Byte in rate</td>
<td><code>kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec</code></td>
<td>当前broker的每秒的入口流量</td>
</tr>
<tr>
<td>Byte out rate</td>
<td><code>kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec</code></td>
<td>当前broker的每秒的出口流量</td>
</tr>
<tr>
<td>Request rate</td>
<td><code>kafka.network:type=RequestMetrics,name=RequestsPerSec,request={Produce or FetchConsumer or FetchFollower}</code></td>
<td>当前broker的每秒的请求量; 根据request的不同会返回不同类型的数据</td>
</tr>
<tr>
<td>Log flush rate and time</td>
<td><code>kafka.log:type=LogFlushStats,name=LogFlushRateAndTimeMs</code></td>
<td>日志刷盘的频率和时间；其中<em>OneMinuteRate:表示一分钟内每秒钟的刷盘次数; </em>999thPercentile:99.9%的刷盘需要的时间</td>
</tr>
<tr>
<td>of under replicated partitions</td>
<td><code>kafka.server:type=ReplicaManager,name=UnderReplicatedPartitions</code></td>
<td>ISR &lt; 备份次数的分区个数，这样的分区应该=0，如果大于0就进行报警最好;</td>
</tr>
<tr>
<td>Is controller active on broker</td>
<td><code>kafka.controller:type=KafkaController,name=ActiveControllerCount</code></td>
<td>当前集群中controller的个数,一个集群只能有一个controller</td>
</tr>
<tr>
<td>Leader election rate</td>
<td><code>kafka.controller:type=ControllerStats,name=LeaderElectionRateAndTimeMs</code></td>
<td>leader选举的频率和需要的时间；其中<em>OneMinuteRate:表示一分钟内出现选举的次数; </em>999thPercentile:99.9%的选举需要的时间</td>
</tr>
<tr>
<td>Unclean leader election rate</td>
<td><code>kafka.controller:type=ControllerStats,name=UncleanLeaderElectionsPerSec</code></td>
<td>非正常的备份被选举成leader的频率;</td>
</tr>
<tr>
<td>Partition counts</td>
<td><code>kafka.server:type=ReplicaManager,name=PartitionCount</code></td>
<td>当前broker的分区个数,就是在存储数据的目录下面的分区个数;</td>
</tr>
<tr>
<td>Leader replica counts</td>
<td><code>kafka.server:type=ReplicaManager,name=LeaderCount</code></td>
<td>当前broker中的leader分区的个数</td>
</tr>
<tr>
<td>ISR shrink rate</td>
<td><code>kafka.server:type=ReplicaManager,name=IsrShrinksPerSec</code></td>
<td>当前broker每分钟分区缩减的频率;</td>
</tr>
<tr>
<td>ISR expansion rate</td>
<td><code>kafka.server:type=ReplicaManager,name=IsrExpandsPerSec</code></td>
<td>当前broker每分钟分区扩展的频率;</td>
</tr>
<tr>
<td>Max lag in messages btw follower and leader replicas</td>
<td><code>kafka.server:type=ReplicaFetcherManager,name=MaxLag,clientId=Replica</code></td>
<td>当前broker中分区与leader之前同步的最大lag数</td>
</tr>
<tr>
<td>Lag in messages per follower replica</td>
<td><code>kafka.server:type=FetcherLagMetrics,name=ConsumerLag,clientId=([-.\w]+),topic=([-.\w]+),partition=([0-9]+)</code></td>
<td>当前broker中备本分区与leader之间的lag数</td>
</tr>
<tr>
<td>Requests waiting in the producer purgatory</td>
<td><code>kafka.server:type=DelayedOperationPurgatory,name=PurgatorySize,delayedOperation=Produce</code></td>
<td>broker中，在等待ack的producer请求个数;还有Fetch、topic、Rebalance、Heartbeat请求</td>
</tr>
<tr>
<td>Request total time</td>
<td><code>kafka.network:type=RequestMetrics,name=TotalTimeMs,request={Produce or FetchConsumer or FetchFollower}</code></td>
<td>请求所需要的全部时间;根据不同的类型求个不一样的结果</td>
</tr>
<tr>
<td>Time the request waits in the request queue</td>
<td><code>kafka.network:type=RequestMetrics,name=RequestQueueTimeMs,request={Produce or FetchConsumer or FetchFollower}</code></td>
<td>请求在队列中等待的时间</td>
</tr>
<tr>
<td>Time the request is processed at the leader</td>
<td><code>kafka.network:type=RequestMetrics,name=LocalTimeMs,request={Produce or FetchConsumer or FetchFollower}</code></td>
<td>请求被leader节点处理的时间</td>
</tr>
<tr>
<td>Time the request waits for the follower</td>
<td><code>kafka.network:type=RequestMetrics,name=RemoteTimeMs,request={Produce or FetchConsumer or FetchFollower}</code></td>
<td>一个请求等待follower的时间;假如ack=all，那么这个值就是非0</td>
</tr>
<tr>
<td>Time the request waits in the response queue</td>
<td><code>kafka.network:type=RequestMetrics,name=ResponseQueueTimeMs,request={Produce or FetchConsumer or FetchFollower}</code></td>
<td>一个请求在response队列中的时间</td>
</tr>
<tr>
<td>Time to send the response</td>
<td><code>kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request={Produce or FetchConsumer or FetchFollower}</code></td>
<td>发送请求的时间</td>
</tr>
<tr>
<td>Number of messages the consumer lags behind the producer by. Published by the consumer, not broker.</td>
<td><code>Old consumer: kafka.consumer:type=ConsumerFetcherManager,name=MaxLag,clientId=([-.\w]+) New consumer: kafka.consumer:type=consumer-fetch-manager-metrics,client-id={client-id} Attribute: records-lag-max</code></td>
<td>consumer落后producer的lag</td>
</tr>
<tr>
<td>The average fraction of time the network processors are idle</td>
<td><code>kafka.network:type=SocketServer,name=NetworkProcessorAvgIdlePercent</code></td>
<td>网络处理空闲的因子，在0，1之间，通常是&gt; 0.3</td>
</tr>
<tr>
<td>The average fraction of time the request handler threads are idle</td>
<td><code>kafka.server:type=KafkaRequestHandlerPool,name=RequestHandlerAvgIdlePercent</code></td>
<td>网络请求线程空闲的平均值，在0，1之间，通常是&gt; 0.3</td>
</tr>
</tbody>
</table>
<h3 id="2-关于zookeeper相关的监控信息"><a href="#2-关于zookeeper相关的监控信息" class="headerlink" title="2. 关于zookeeper相关的监控信息"></a>2. 关于zookeeper相关的监控信息</h3><table>
<thead>
<tr>
<th>mbean name</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>kafka.server:type=SessionExpireListener,name=ZooKeeperDisconnectedPerSec</code></td>
<td>当前broker与zk之间的每秒断链的次数；也就是频率</td>
</tr>
<tr>
<td><code>kafka.server:type=SessionExpireListener,name=ZooKeeperSyncConnectedPerSec</code></td>
<td>ZooKeeper client is connected to the ensemble and ready to execute operations</td>
</tr>
<tr>
<td><code>kafka.server:type=SessionExpireListener,name=ZooKeeperAuthFailedPerSec</code></td>
<td>与zk进行连接并且是因为认证失败的每秒的次数</td>
</tr>
<tr>
<td><code>kafka.server:type=SessionExpireListener,name=ZooKeeperConnectedReadOnlyPerSec</code></td>
<td>The server the client is connected to is currently LOOKING, which means that it is neither FOLLOWING nor LEADING. Consequently, the client can only read the ZooKeeper state, but not make any changes (create, delete, or set the data of znodes).</td>
</tr>
<tr>
<td><code>kafka.server:type=SessionExpireListener,name=ZooKeeperSaslAuthenticatedPerSec</code></td>
<td>zkclient被验证成功每秒的次数</td>
</tr>
<tr>
<td><code>kafka.server:type=SessionExpireListener,name=ZooKeeperExpiredPerSec</code></td>
<td>当前zkclient被过期的每秒次数</td>
</tr>
</tbody>
</table>
<h3 id="3-consumer和producer的监控信息"><a href="#3-consumer和producer的监控信息" class="headerlink" title="3. consumer和producer的监控信息"></a>3. consumer和producer的监控信息</h3><ul>
<li><a href="http://docs.confluent.io/3.0.0/kafka/monitoring.html#producer-global-request-metrics" target="_blank" rel="external">confluent doc</a></li>
<li><a href="https://kafka.apache.org/documentation/#monitoring" target="_blank" rel="external">kafka doc</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="nomoshen" />
          <p class="site-author-name" itemprop="name">nomoshen</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">Artikel</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nomoshen</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
