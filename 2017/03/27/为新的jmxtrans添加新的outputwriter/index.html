<!doctype html>
<html lang="en">
    <head><meta name="generator" content="Hexo 3.9.0">
		
        <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content>
        <link rel="shortcut icon" href="/asset/guolin.png">
        <link rel="canonical" href="http://guolinn.com/">
        <link rel="alternate" type="application/rss+xml" title="nomoshen" href="/atom.xml">
        <title>为新的jmxtrans添加新的outputwriter | nomoshen</title>
        <meta name="description" content="{{meta_description}}">

        <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/styles/crisp.css">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    </head>
    
		<body class="post-template">
	

        <header id="header">
            <a id="logo" href="/"><img src="/asset/guolin.png" alt="nomoshen"></a>
            <h1><a href="/">nomoshen</a></h1>
            <p>尽可能努力一点点</p>
            <div id="follow-icons">
                  <a href="/atom.xml"><i class="fa fa-rss-square fa-2x"></i></a>
  </div>
<h6><a href="/about">About</a></h6>
        </header>

        <main id="content">
        

<article class="post">
  March 27, 2017
  
    <span class="taglist">  &middot; 
    
    
      <a href="/tags/monitor/">monitor</a> 
    
      <a href="/tags/jmxtrans/">jmxtrans</a> 
    
    </span>
  

  <h1 class="post-title">为新的jmxtrans添加新的outputwriter</h1>
  <section class="post-content article-entry">
    <p><a href="https://github.com/jmxtrans/jmxtrans" target="_blank" rel="noopener">jmxtrans</a>是一个开源产品，主要的作用是通过定时轮训程序的jmx端口来获得程序内部的信息，并且输出到对应的外界监控系统，比如ganglia、es、influxdb等；由于它的这种作用，所以不少的人将它使用在对一些开源组件的监控. 而我主要用它来将kafka中的broker信息输出到我们内部的监控。</p>
<p>年前已经将监控信息输出到了ganglia，但是这不能与我们的报警系统好好的融合起来，我基本不可能时时刻刻盯着监控图标在看的，为此所以我就必须将让kafka的监控数据输出到我们内部的监控，并且对一些特定的metric设置报警，这样就可以对kafka内部的一些状态进行监控，也能更加快的发现问题。</p>
<h4 id="1-安装一个稳定版本的jmxtrans"><a href="#1-安装一个稳定版本的jmxtrans" class="headerlink" title="1. 安装一个稳定版本的jmxtrans"></a>1. 安装一个稳定版本的jmxtrans</h4><p>jmxtrans提供了rpm包，你可以直接通过如下命令来安装；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh jmxtrans-260.rpm</span><br></pre></td></tr></table></figure>
<p>安装完之后，jmxtrans会在几个目录存放对应的配置文件、日志、pid等，对此我也是很纠结，就不能想其他的程序一样放的正规一点吗，几个目录还不在一起;</p>
<ul>
<li>/var/log/jmxtrans/jmxtrans.log: jmxtrans运行的日志</li>
<li>/var/run/jmxtrans/jmxtrans.pid: 存放jmxtrans对应的pid</li>
<li>/usr/shared/jmxtrans/:这个目录下面存放的jmxtrans的库文件、可执行文件、一些jmx的配置</li>
<li>/var/lib/jmxtrans/:这个目录下面存放的需要采集的配置文件，通常是json;</li>
</ul>
<h4 id="2-下载对应版本的jmxtrans"><a href="#2-下载对应版本的jmxtrans" class="headerlink" title="2. 下载对应版本的jmxtrans"></a>2. 下载对应版本的jmxtrans</h4><p>我使用的260版本的jmxtrans，于是我从它们的github网址下载了源码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/jmxtrans/jmxtrans/archive/jmxtrans-parent-260.tar.gz</span><br></pre></td></tr></table></figure>
<p>然后用intellij打开对应的工程;</p>
<h4 id="3-添加自己的outputwriter"><a href="#3-添加自己的outputwriter" class="headerlink" title="3. 添加自己的outputwriter"></a>3. 添加自己的outputwriter</h4><p>这个部分我就大概说一下，具体可以看<code>jmxtrans-output-log4j中KeyOutWriter</code>这个类，因为很简单，很快就模拟然后进行自己的改造;</p>
<ul>
<li>创建自己的outputwriter模块，比如我就自己在jmxtrans-output创建了一个<code>jmxtrans-output-sentry</code>模块，pom.xml只需要将对应的依赖加上的，记得一定会依赖如下几个依赖:</li>
</ul>
<pre><code>&lt;dependency&gt;
   &lt;groupId&gt;org.jmxtrans&lt;/groupId&gt;
   &lt;artifactId&gt;jmxtrans-core&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
   &lt;groupId&gt;org.jmxtrans&lt;/groupId&gt;
   &lt;artifactId&gt;jmxtrans-utils&lt;/artifactId&gt;
&lt;/dependency&gt; 
&lt;dependency&gt;
   &lt;groupId&gt;org.jmxtrans&lt;/groupId&gt;
   &lt;artifactId&gt;jmxtrans-test-utils&lt;/artifactId&gt;
   &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre><ul>
<li><p>创建你自己的outputwriter类，并且继承<code>BaseOutputWriter</code>;下面的代码中我把公司内部的代码给去掉了，但是其实是一个很简单的输出端，不影响整个过程，下面的循环就对应的后面配置中的每一次你需要的查询；代码中的<code>metric</code> 和 <code>value</code>就是对应的key和value;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">	public class SentryOutWriter extends BaseOutputWriter &#123;</span><br><span class="line">    private static Logger logger = LoggerFactory.getLogger(SentryOutWriter.class);</span><br><span class="line">    private Map&lt;String, String&gt; fixTags = new HashMap&lt;&gt;();</span><br><span class="line">    private String clustername;</span><br><span class="line"></span><br><span class="line">    @JsonCreator</span><br><span class="line">    public SentryOutWriter(@JsonProperty(&quot;typeNames&quot;) ImmutableList&lt;String&gt; typeNames,</span><br><span class="line">                           @JsonProperty(&quot;booleanAsNumber&quot;) boolean booleanAsNumber,</span><br><span class="line">                           @JsonProperty(&quot;debug&quot;) Boolean debugEnabled,</span><br><span class="line">                           @JsonProperty(&quot;settings&quot;) Map&lt;String, Object&gt; settings,</span><br><span class="line">                           @JsonProperty(&quot;clustername&quot;) String clustername) &#123;</span><br><span class="line">        super(typeNames, booleanAsNumber, debugEnabled, settings);</span><br><span class="line">        logger.info(&quot;SentryOutWriter is init&quot;);</span><br><span class="line"></span><br><span class="line">        this.clustername = clustername;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void validateSetup(Server server, Query query) throws ValidationException &#123;&#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void internalWrite(Server server, Query query, ImmutableList&lt;Result&gt; results) throws Exception &#123;</span><br><span class="line">        List&lt;String&gt; typeNames = getTypeNames();</span><br><span class="line">        long now = System.currentTimeMillis()/1000;</span><br><span class="line">        for (Result result : results) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; resultValues = result.getValues();</span><br><span class="line">            for (Map.Entry&lt;String, Object&gt; values : resultValues.entrySet()) &#123;</span><br><span class="line">                if (isNumeric(values.getValue())) &#123;</span><br><span class="line">                    String mbeanAlias = Util.getMBeanIdentifier(query, result);</span><br><span class="line">                    String key = Util.getKeyString(query, result, values);</span><br><span class="line"></span><br><span class="line">                    if(Strings.isNullOrEmpty(mbeanAlias) || Strings.isNullOrEmpty(key))&#123;</span><br><span class="line">                        continue;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    String metric = mbeanAlias + &quot;.&quot; + key;</span><br><span class="line">                    Double value = null;</span><br><span class="line">                   </span><br><span class="line">                    if(values.getValue() instanceof Double)&#123;</span><br><span class="line">                          value = (Double) values.getValue();</span><br><span class="line">                    &#125;else if(values.getValue() instanceof Long)&#123;</span><br><span class="line">                        value = Double.valueof((Long) values.getValue());</span><br><span class="line">                    &#125;else if(values.getValue() instanceof Integer) &#123;</span><br><span class="line">                        value = Long.valueOf((Integer)values.getValue());</span><br><span class="line">                    &#125; else if(values.getValue() instanceof String)&#123;</span><br><span class="line">                        value = Double.valueOf((String)values.getValue());</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        try&#123;</span><br><span class="line">                            value =  Double.valueOf((Double)values.getValue());</span><br><span class="line">                        &#125;catch (Exception e)&#123;</span><br><span class="line">                            logger.error(&quot;to double is error,&#123;&#125;&quot;, e);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    logger.error(&quot;metrci:&#123;&#125;&quot;, metric);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>将你自己的模块打包</li>
</ul>
<h4 id="4-将你的包导入的之前已经安装完的稳定版本中"><a href="#4-将你的包导入的之前已经安装完的稳定版本中" class="headerlink" title="4. 将你的包导入的之前已经安装完的稳定版本中"></a>4. 将你的包导入的之前已经安装完的稳定版本中</h4><p>其实jmxtrans没有提供很好的方式可以将自定义的包放到它们的stable版本中，起码我没有很好的方式；但是在模仿其他包的时候我还是发现了一些可行的方式来导入自己的包；</p>
<ol>
<li><p>确定你的jar依赖的其他的jar包；</p>
<p> 因为你自定义的jar可能还依赖出jmxtrans本身的其他的jar，所以你实现应该确定好有哪些jar包需要额外依赖；比如我就额外的包就是我司内部的监控client jar包;</p>
</li>
<li><p>将你的包上传到jmxtrans的服务端</p>
<ul>
<li>/usr/shared/jmxtrans/lib/这目录下面就是用来存放对应的jar包的,其中<code>/usr/share/jmxtrans/lib/org/jmxtrans</code>就是用来存放对应输出端的jar，所以你要把你自定的jar包放在这里;比如我就放在<code>/usr/share/jmxtrans/lib/org/jmxtrans/jmxtrans-output-sentry/260/</code>下面，jar包名字叫做<code>jmxtrans-output-sentry-260.jar</code></li>
<li>上传额外依赖包，按照标准的方式存放即可，lib目录下面有很多的例子可以模仿</li>
</ul>
</li>
<li><p>修改wrapper.conf文件</p>
<p> <code>/usr/share/jmxtrans/etc/wrapper.conf</code>是jmxtrans的启动配置文件，里面包含了启动需要加载那些包，所以需要添加jar的依赖;</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wrapper.java.classpath.89=%REPO_DIR%/org/slf4j/slf4j-log4j12/1.7.21/slf4j-log4j12-1.7.21.jar</span><br><span class="line">wrapper.java.classpath.90=%REPO_DIR%/org/jmxtrans/jmxtrans-output-sentry/260/jmxtrans-output-sentry-260.jar</span><br><span class="line">wrapper.java.classpath.91=%REPO_DIR%/com/xxxx/xxxx/xxx.jar</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><p>去修改<code>/var/lib/jmxtrans/kafka.json</code>修改outputwriter的类型</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><span class="line">	&#123;</span><br><span class="line">  &quot;servers&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;port&quot;: &quot;your sever jmx port&quot;,</span><br><span class="line">      &quot;host&quot;: &quot;your server ip&quot;,</span><br><span class="line">      &quot;queries&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;java.lang:type=Memory&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;memory&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;HeapMemoryUsage&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;java.lang:type=GarbageCollector,name=G1 Old Generation&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;FullGC&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;CollectionCount&quot;,</span><br><span class="line">            &quot;CollectionTime&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;MessagesIn&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;BytesIn&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;BytesOut&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestsPerSec,request=Produce&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;ProduceRequests&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestsPerSec,request=FetchConsumer&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;FetchConsumerRequests&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestsPerSec,request=FetchFollower&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;FetchFollowerRequests&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.log:type=LogFlushStats,name=LogFlushRateAndTimeMs&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;LogflushRateAndTime&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;OneMinuteRate&quot;,</span><br><span class="line">            &quot;999thPercentile&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.log:type=ReplicaManager,name=UnderReplicatedPartitions&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;UnISRPartitionCnt&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;Value&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.controller:type=KafkaController,name=ActiveControllerCount&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;ActiveControllerCnt&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;Value&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.controller:type=ControllerStats,name=LeaderElectionRateAndTimeMs&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;LeaderRateAndTime&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;999thPercentile&quot;,</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.controller:type=ControllerStats,name=UncleanLeaderElectionsPerSec&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;UncleanLeaderRateAndTime&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;999thPercentile&quot;,</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.server:type=ReplicaManager,name=PartitionCount&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;PartitionCnt&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;Value&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.server:type=ReplicaManager,name=LeaderCount&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;LeaderCnt&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;Value&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.server:type=DelayedOperationPurgatory,name=PurgatorySize,delayedOperation=Produce&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;ProducerPurgatorySize&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;Value&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.server:type=DelayedOperationPurgatory,name=PurgatorySize,delayedOperation=Fetch&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;FetchPurgatorySize&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;Value&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestQueueTimeMs,request=FetchConsumer&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;FetchConsumerWait&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;999thPercentile&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=RequestQueueTimeMs,request=Produce&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;ProduceWait&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;999thPercentile&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=LocalTimeMs,request=FetchConsumer&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;FetchConsumerProcessTime&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;999thPercentile&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.network:type=RequestMetrics,name=LocalTimeMs,request=Produce&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;ProduceProcessTime&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;999thPercentile&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.server:type=SessionExpireListener,name=ZooKeeperDisconnectsPerSec&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;ZKDisConnectCnt&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;outputWriters&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;@class&quot;: &quot;com.googlecode.jmxtrans.model.output.SentryOutWriter&quot;,</span><br><span class="line">              &quot;clustername&quot;: &quot;offline-kafka&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">          &quot;obj&quot;: &quot;kafka.server:type=SessionExpireListener,name=ZooKeeperExpiredPerSec&quot;,</span><br><span class="line">          &quot;resultAlias&quot;: &quot;ZKExpiredCnt&quot;,</span><br><span class="line">          &quot;attr&quot;: [</span><br><span class="line">            &quot;OneMinuteRate&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;numQueryThreads&quot;: 1</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h4><p>这样就可以把数据输出到我自己的监控;关于kafka的监控信息可以看<a href="http://andrewrong.github.io/2017/03/26/kafka-broker%E7%9A%84%E7%9B%91%E6%8E%A7%E4%BF%A1%E6%81%AF/" target="_blank" rel="noopener">这篇文章</a>，有什么问题可以通过<a href="https://twitter.com/andrew_rong" target="_blank" rel="noopener">twitter</a>私信给我;</p>

  </section>
  <footer class="post-footer">
    <!--
    <section class="author">
      <h4>nomoshen</h4>
      <p></p>
    </section>
    -->
  </footer>
</article>

<nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/2017/04/04/scylladb-官文安装译文/">
        ← prev <!--scylladb 官文安装译文-->
    </a>
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/2017/03/26/kafka-broker的监控信息/">
        <!--kafka broker的监控信息--> next →
    </a>
    
</nav>


        </main>
        <footer id="footer">
            <section id="footer-message">&copy; 2020 nomoshen. All rights reserved. Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. <a href="https://github.com/guolin/crisp-hexo-theme" target="_blank">crisp</a> theme by <a href="guolin.github.io" target="_blank">Guo Lin</a>.</section>
        </footer>
    </body>
</html>


